<!DOCTYPE html>
<html lang="es">
<!-- Version 2.0 - Updated 2026-02-13 -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Rentabilidad CRECE - Inversi√≥n en Inmuebles Usados</title>
    <!-- Fonts: Inter -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffffff;
            color: #0f172a;
            -webkit-font-smoothing: antialiased;
            background-image: radial-gradient(circle at top right, rgba(99, 102, 241, 0.03), transparent 40%),
                radial-gradient(circle at bottom left, rgba(168, 85, 247, 0.03), transparent 40%);
            min-height: 100vh;
        }

        .glass {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(0, 0, 0, 0.05);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.04), 0 4px 6px -4px rgba(0, 0, 0, 0.02);
        }

        .aura-gradient-text {
            background: linear-gradient(135deg, #0f172a 0%, #475569 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .section-header {
            font-size: 20px;
            font-weight: bold;
            text-align: center;
            padding: 16px;
            margin-bottom: 24px;
            border-radius: 12px;
            border: 1px solid rgba(0, 0, 0, 0.05);
            color: #1e293b;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }

        /* T√çTULOS DE SECCI√ìN PERSONALIZADOS (SOLO EL HEADER) */
        /* 1. Datos (Blue/Sky) */
        .section-datos .section-header {
            background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%);
            color: #0369a1;
            border-color: #7dd3fc;
        }

        /* 2. Financiaci√≥n (Teal) */
        .section-financiacion .section-header {
            background: linear-gradient(135deg, #ccfbf1 0%, #99f6e4 100%);
            color: #0f766e;
            border-color: #5eead4;
        }

        /* 3. Tenencia (Amber) */
        .section-tenencia .section-header {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            color: #b45309;
            border-color: #fcd34d;
        }

        /* 4. Venta (Indigo) */
        .section-venta .section-header {
            background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%);
            color: #4338ca;
            border-color: #a5b4fc;
        }

        /* 5. Resultado (Full Colored Container - Exception) */
        .section-resultado {
            background-color: #ecfdf5 !important;
            border: 2px solid #6ee7b7 !important;
        }

        .section-resultado .section-header {
            background: #10b981;
            color: #ffffff;
            border: none;
        }

        .section-resultado .field-input-wrapper {
            background-color: #d1fae5 !important;
            border-color: #6ee7b7 !important;
        }

        .section-resultado .field-input-wrapper input {
            color: #065f46 !important;
            font-weight: 800;
        }

        .section-resultado .currency-symbol,
        .section-resultado .percent-symbol {
            color: #059669 !important;
        }

        .field-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        .field-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
            /* Allow tooltip overflow */
            position: relative;
        }

        .field-item.full-width {
            grid-column: 1 / -1;
        }

        .field-label {
            font-weight: 600;
            font-size: 14px;
            color: #334155;
        }

        .field-input-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
            background: white;
            border: 1.5px solid #cbd5e1;
            border-radius: 10px;
            padding: 12px 16px;
            transition: all 0.2s;
        }

        .field-input-wrapper:focus-within {
            border-color: #64748b;
            box-shadow: 0 0 0 3px rgba(100, 116, 139, 0.1);
        }

        .field-input-wrapper.calculated {
            background: #f8fafc;
            /* Default calculated bg */
        }

        /* Calculated fields tinte espec√≠fico por secci√≥n */
        .section-datos .field-input-wrapper.calculated {
            background: #f0f9ff;
            border-color: #bae6fd;
        }

        .section-financiacion .field-input-wrapper.calculated {
            background: #f0fdfa;
            border-color: #99f6e4;
        }

        .section-tenencia .field-input-wrapper.calculated {
            background: #fffbeb;
            border-color: #fde68a;
        }

        .section-venta .field-input-wrapper.calculated {
            background: #eef2ff;
            border-color: #c7d2fe;
        }

        .field-input-wrapper input {
            flex: 1;
            border: none;
            background: transparent;
            font-size: 15px;
            font-weight: 600;
            outline: none;
            text-align: left;
            color: #0f172a;
        }

        .currency-symbol,
        .percent-symbol {
            font-weight: 700;
            font-size: 14px;
            color: #64748b;
        }

        .primary-button {
            background-color: #0f172a;
            color: white;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .primary-button:hover {
            background-color: #1e293b;
            transform: translateY(-1px);
            box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.2);
        }

        .tooltip-trigger {
            position: relative;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            background-color: #0f172a;
            color: white;
            border-radius: 50%;
            font-size: 12px;
            font-weight: bold;
            cursor: help;
            margin-left: 6px;
            flex-shrink: 0;
            vertical-align: middle;
        }

        .tooltip-trigger:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        .tooltip-text {
            visibility: hidden;
            opacity: 0;
            position: absolute;
            z-index: 10000;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background-color: #0f172a;
            color: white;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: normal;
            line-height: 1.5;
            width: 280px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            transition: opacity 0.3s, visibility 0.3s;
            white-space: normal;
            pointer-events: none;
        }

        .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 8px solid transparent;
            border-top-color: #0f172a;
        }

        @media (max-width: 768px) {
            .field-row {
                grid-template-columns: 1fr;
                gap: 16px;
            }
        }
    </style>
</head>

<body class="selection:bg-slate-200">
    <div class="w-full flex justify-center py-6">
        <img src="https://storage.googleapis.com/msgsndr/e3ptBMQArqbC3YL2ik2n/media/69467d01106fdc3c581d774f.png"
            alt="Logo" class="h-16 object-contain">
    </div>

    <div class="container mx-auto px-4 pb-8 max-w-5xl">
        <!-- Header -->
        <div class="glass rounded-3xl p-8 mb-6 border border-slate-100 text-center">
            <h1 class="text-3xl md:text-4xl font-bold mb-2 aura-gradient-text uppercase">SIMULADOR DE RENTABILIDAD CRECE
            </h1>
            <p class="text-lg font-semibold text-slate-700">INVERSI√ìN EN INMUEBLES USADOS</p>
            <p class="text-md text-slate-600 mb-4">Estrategia: Comprar con Financiaci√≥n, Mejorar y Vender</p>
            <div class="bg-slate-50 rounded-lg p-3 border border-slate-200 inline-block max-w-4xl">
                <p class="text-sm text-slate-700">
                    <strong>OBJETIVO:</strong> Ayudar al inversionista a simular y analizar la rentabilidad de una
                    estrategia orientada a adquirir un inmueble usado con financiaci√≥n, realizar mejoras que incrementen
                    su valor y venderlo posteriormente.
                </p>
            </div>

            <!-- Nombre del Proyecto -->
            <div class="mt-4 flex items-center justify-center gap-2">
                <label for="nombreProyecto" class="text-sm font-semibold text-slate-700">üìù Nombre del Proyecto o Inversi√≥n:</label>
                <input type="text" id="nombreProyecto" placeholder="Ej: Proyecto Alto de la Mar√≠a"
                    class="border border-slate-300 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-slate-400" style="width: 500px;">
            </div>
        </div>

        <!-- 1. DATOS DE COMPRA -->
        <div class="glass rounded-3xl p-8 mb-6 border border-slate-100 section-datos">
            <div class="section-header">üìã DATOS DE COMPRA DEL INMUEBLE</div>
            <div class="field-row">
                <div class="field-item">
                    <label class="field-label">
                        Precio de Compra
                        <span class="tooltip-trigger">
                            i
                            <span class="tooltip-text">Valor final pagado por el inmueble, luego de aplicar el descuento
                                negociado mediante las t√°cticas de Captura de Oportunidades del Sistema CRECE.</span>
                        </span>
                    </label>
                    <div class="field-input-wrapper">
                        <span class="currency-symbol">$</span>
                        <input type="text" id="precioCompra" value="207.000.000">
                    </div>
                </div>
                <div class="field-item">
                    <label class="field-label">
                        √Årea del Inmueble (M¬≤)
                        <span class="tooltip-trigger">
                            i
                            <span class="tooltip-text">Ingrese el √°rea construida que registra en las escrituras.</span>
                        </span>
                    </label>
                    <div class="field-input-wrapper">
                        <input type="number" id="areaM2" value="50">
                        <span class="percent-symbol">M¬≤</span>
                    </div>
                </div>
            </div>
            <div class="field-row">
                <div class="field-item">
                    <label class="field-label">
                        Valor por M¬≤
                        <span class="tooltip-trigger">
                            i
                            <span class="tooltip-text">Valor que se utiliza para realizar an√°lisis comparativos de
                                precios de mercado, tomando como referencia el √°rea del inmueble.</span>
                        </span>
                    </label>
                    <div class="field-input-wrapper calculated">
                        <span class="currency-symbol">$</span>
                        <input type="text" id="valorM2" readonly>
                    </div>
                </div>
                <div class="field-item">
                    <label class="field-label">Costo de Mejoras o Remodelaci√≥n</label>
                    <div class="field-input-wrapper">
                        <span class="currency-symbol">$</span>
                        <input type="text" id="costoMejoras" value="10.000.000">
                    </div>
                </div>
            </div>
            <div class="field-row">
                <div class="field-item">
                    <label class="field-label">
                        % Costos de Escrituraci√≥n (Compra)
                        <span class="tooltip-trigger">
                            i
                            <span class="tooltip-text">Porcentaje aplicado al precio de compra del inmueble para cubrir
                                los costos de escrituraci√≥n. Var√≠a seg√∫n la Ciudad y el Pa√≠s.</span>
                        </span>
                    </label>
                    <div class="field-input-wrapper">
                        <input type="number" id="porcentajeEscrituracionCompra" value="2.5" step="0.1">
                        <span class="percent-symbol">%</span>
                    </div>
                </div>
                <div class="field-item">
                    <label class="field-label">Costos de Escrituraci√≥n por Compra</label>
                    <div class="field-input-wrapper calculated">
                        <span class="currency-symbol">$</span>
                        <input type="text" id="costosEscrituracionCompra" readonly>
                    </div>
                </div>
            </div>
            <div class="field-row">
                <div class="field-item">
                    <label class="field-label">% Financiaci√≥n (Cr√©dito)</label>
                    <div class="field-input-wrapper">
                        <input type="number" id="porcentajeFinanciacion" value="70" max="100">
                        <span class="percent-symbol">%</span>
                    </div>
                </div>
                <div class="field-item">
                    <label class="field-label">
                        Valor de la Cuota Inicial
                        <span class="tooltip-trigger">
                            i
                            <span class="tooltip-text">La cuota inicial ("enganche" o "entrada") es el monto de dinero
                                que el comprador paga de sus propios recursos para asegurar la propiedad, representando
                                una parte del valor total del inmueble.</span>
                        </span>
                    </label>
                    <div class="field-input-wrapper calculated">
                        <span class="currency-symbol">$</span>
                        <input type="text" id="valorCuotaInicial" readonly>
                    </div>
                </div>
            </div>
            <div class="field-row">
                <div class="field-item">
                    <label class="field-label">Valor del Cr√©dito Hipotecario</label>
                    <div class="field-input-wrapper calculated">
                        <span class="currency-symbol">$</span>
                        <input type="text" id="valorCredito" readonly>
                    </div>
                </div>
                <div class="field-item">
                    <!-- Espacio vac√≠o para mantener alineaci√≥n -->
                </div>
            </div>
        </div>

        <!-- 2. FINANCIACI√ìN -->
        <div class="glass rounded-3xl p-8 mb-6 border border-slate-100 section-financiacion">
            <div class="section-header">üè¶ FINANCIACI√ìN (Cr√©dito Hipotecario)</div>
            <div class="field-row">
                <div class="field-item">
                    <label class="field-label">
                        Plazo del Cr√©dito (A√±os)
                        <span class="tooltip-trigger">
                            i
                            <span class="tooltip-text">N√∫mero de a√±os durante los cuales se proyecta el Cr√©dito
                                Hipotecario.</span>
                        </span>
                    </label>
                    <div class="field-input-wrapper">
                        <input type="number" id="plazoAnos" value="20">
                    </div>
                </div>
                <div class="field-item">
                    <label class="field-label">Tasa Efectiva Anual (E.A.)</label>
                    <div class="field-input-wrapper">
                        <input type="number" id="tasaEA" value="12" step="0.01">
                        <span class="percent-symbol">%</span>
                    </div>
                </div>
            </div>
            <div class="field-row">
                <div class="field-item">
                    <label class="field-label">Tasa Efectiva Mensual (E.M.)</label>
                    <div class="field-input-wrapper calculated">
                        <input type="text" id="tasaEM" readonly>
                        <span class="percent-symbol">%</span>
                    </div>
                </div>
                <div class="field-item">
                    <label class="field-label">
                        Cuota Mensual del Cr√©dito (Sin Seguros)
                        <span class="tooltip-trigger">
                            i
                            <span class="tooltip-text">Valor estimado de la cuota del cr√©dito hipotecario, sin incluir
                                los seguros exigidos por el Banco. Este valor se presenta √∫nicamente como referencia de
                                simulaci√≥n, ya que el valor real de la cuota mensual es determinado por la Entidad
                                Financiera o Banco.</span>
                        </span>
                    </label>
                    <div class="field-input-wrapper calculated">
                        <span class="currency-symbol">$</span>
                        <input type="text" id="cuotaMensual" readonly>
                    </div>
                </div>
            </div>
        </div>

        <!-- 3. COSTOS DE TENENCIA -->
        <div class="glass rounded-3xl p-8 mb-6 border border-slate-100 section-tenencia">
            <div class="section-header">üè† COSTOS MENSUALES DE TENENCIA</div>
            <div class="field-row">
                <div class="field-item">
                    <label class="field-label">
                        Administraci√≥n Mensual
                        <span class="tooltip-trigger">
                            i
                            <span class="tooltip-text">Costo mensual por el mantenimiento y operaci√≥n de las √°reas
                                comunes del inmueble. Solo aplica a inmuebles en unidades residenciales con cuota de
                                mantenimiento.</span>
                        </span>
                    </label>
                    <div class="field-input-wrapper">
                        <span class="currency-symbol">$</span>
                        <input type="text" id="administracionMensual" value="200.000">
                    </div>
                </div>
                <div class="field-item">
                    <label class="field-label">Servicios P√∫blicos Mensual</label>
                    <div class="field-input-wrapper">
                        <span class="currency-symbol">$</span>
                        <input type="text" id="serviciosPublicosMensual" value="80.000">
                    </div>
                </div>
            </div>
            <div class="field-row">
                <div class="field-item">
                    <label class="field-label">
                        Otros Costos del Mes
                        <span class="tooltip-trigger">
                            i
                            <span class="tooltip-text">Indica posibles costos como los seguros obligatorios del cr√©dito
                                y otros pagos menores relacionados con la tenencia de la propiedad previo a la
                                venta.</span>
                        </span>
                    </label>
                    <div class="field-input-wrapper">
                        <span class="currency-symbol">$</span>
                        <input type="text" id="otrosCostosMes" value="100.000">
                    </div>
                </div>
                <div class="field-item">
                    <label class="field-label">
                        Costo Total de Tenencia Mensual
                        <span class="tooltip-trigger">
                            i
                            <span class="tooltip-text">Representa la suma de costos peri√≥dicos que el propietario debe
                                asumir una vez recibe el inmueble previo a la venta.</span>
                        </span>
                    </label>
                    <div class="field-input-wrapper calculated">
                        <span class="currency-symbol">$</span>
                        <input type="text" id="costoTotalTenenciaMensual" readonly>
                    </div>
                </div>
            </div>
        </div>

        <!-- 4. SALIDA POR VENTA -->
        <div class="glass rounded-3xl p-8 mb-6 border border-slate-100 section-venta">
            <div class="section-header">üí∞ SALIDA POR VENTA</div>
            <div class="field-row">
                <div class="field-item">
                    <label class="field-label">Precio de Venta Esperado</label>
                    <div class="field-input-wrapper">
                        <span class="currency-symbol">$</span>
                        <input type="text" id="precioVentaEsperado" value="260.000.000">
                    </div>
                </div>
                <div class="field-item">
                    <label class="field-label">
                        Mes Estimado de Venta
                        <span class="tooltip-trigger">
                            i
                            <span class="tooltip-text">Mes en el que se proyecta vender el inmueble. A menor tiempo de
                                venta, mayor Rentabilidad.</span>
                        </span>
                    </label>
                    <div class="field-input-wrapper">
                        <input type="number" id="mesEstimadoVenta" value="6">
                    </div>
                </div>
            </div>
            <div class="field-row">
                <div class="field-item">
                    <label class="field-label">
                        Costo Tenencia Acumulado
                        <span class="tooltip-trigger">
                            i
                            <span class="tooltip-text">Valor total de los costos de tenencia del inmueble y de las
                                cuotas del cr√©dito hipotecario pagadas desde la entrega del inmueble hasta su
                                venta.</span>
                        </span>
                    </label>
                    <div class="field-input-wrapper calculated">
                        <span class="currency-symbol">$</span>
                        <input type="text" id="costoTenenciaAcumulado" readonly>
                    </div>
                </div>
                <div class="field-item">
                    <label class="field-label">
                        Valorizaci√≥n Frente al Precio de Compra
                        <span class="tooltip-trigger">
                            i
                            <span class="tooltip-text">Indica en qu√© porcentaje ha aumentado el valor del inmueble en
                                comparaci√≥n con el precio inicial de compra.</span>
                        </span>
                    </label>
                    <div class="field-input-wrapper calculated">
                        <input type="text" id="valorizacion" readonly>
                        <span class="percent-symbol">%</span>
                    </div>
                </div>
            </div>
            <div class="field-row">
                <div class="field-item">
                    <label class="field-label">
                        % Costos Escrituraci√≥n (Venta)
                        <span class="tooltip-trigger">
                            i
                            <span class="tooltip-text">Porcentaje aplicado al precio de venta del inmueble para cubrir
                                los costos de escrituraci√≥n. Var√≠a seg√∫n la Ciudad y el Pa√≠s.</span>
                        </span>
                    </label>
                    <div class="field-input-wrapper">
                        <input type="number" id="porcentajeEscrituracionVenta" value="2.5" step="0.1">
                        <span class="percent-symbol">%</span>
                    </div>
                </div>
                <div class="field-item">
                    <label class="field-label">Costos Escrituraci√≥n por Venta</label>
                    <div class="field-input-wrapper calculated">
                        <span class="currency-symbol">$</span>
                        <input type="text" id="costosEscrituracionVenta" readonly>
                    </div>
                </div>
            </div>
            <div class="field-row">
                <div class="field-item">
                    <label class="field-label">
                        Saldo Cr√©dito al Momento Venta
                        <span class="tooltip-trigger">
                            i
                            <span class="tooltip-text">Valor estimado por pagar del cr√©dito hipotecario al momento de la
                                venta del inmueble. Este valor se presenta √∫nicamente como referencia de simulaci√≥n, ya
                                que el saldo real es determinado por la Entidad Financiera o Banco.</span>
                        </span>
                    </label>
                    <div class="field-input-wrapper calculated">
                        <span class="currency-symbol">$</span>
                        <input type="text" id="saldoCreditoVenta" readonly>
                    </div>
                </div>
                <div class="field-item">
                    <label class="field-label">
                        Otros Costos Venta
                        <span class="tooltip-trigger">
                            i
                            <span class="tooltip-text">Representa eventuales pagos de comisiones o tributos relacionados
                                con la venta.</span>
                        </span>
                    </label>
                    <div class="field-input-wrapper">
                        <span class="currency-symbol">$</span>
                        <input type="text" id="otrosCostosVenta" value="2.000.000">
                    </div>
                </div>
            </div>
        </div>

        <!-- 5. RESULTADOS -->
        <div class="glass rounded-3xl p-8 mb-6 border border-slate-100 section-resultado">
            <div class="flex justify-end mb-4">
                <button onclick="descargarPDF()"
                    class="primary-button px-6 py-3 rounded-xl font-bold shadow-lg flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                        </path>
                    </svg>
                    Descargar Informe PDF
                </button>
            </div>
            <div class="section-header">üìä RESULTADOS DE LA INVERSI√ìN</div>
            <div id="resultadoNegativo"
                class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4 text-center font-bold">
                La Rentabilidad de esta simulaci√≥n es Negativa. Debe revisar el precio de venta con respecto al precio
                de compra y los costos de la operaci√≥n.
            </div>
            <div id="contenedorResultados">
                <div class="field-row">
                    <div class="field-item">
                        <label class="field-label">
                            CAPITAL TOTAL INVERTIDO
                            <span class="tooltip-trigger" style="background-color: #064e3b; color: #ecfdf5;">
                                i
                                <span class="tooltip-text">Es el dinero real que sali√≥ del bolsillo del inversionista
                                    para ejecutar la operaci√≥n.</span>
                            </span>
                        </label>
                        <div class="field-input-wrapper calculated"><span class="currency-symbol">$</span><input
                                type="text" id="capitalTotalInvertido" readonly></div>
                    </div>
                    <div class="field-item">
                        <label class="field-label">
                            CAPITAL DE REINVERSI√ìN
                            <span class="tooltip-trigger" style="background-color: #064e3b; color: #ecfdf5;">
                                i
                                <span class="tooltip-text">Es el dinero que queda disponible despu√©s de cerrar una
                                    inversi√≥n, pagando el saldo del cr√©dito y los costos asociados a la venta. Este
                                    capital se utiliza para seguir invirtiendo y hacer crecer el patrimonio de forma
                                    progresiva dentro del Sistema CRECE.</span>
                            </span>
                        </label>
                        <div class="field-input-wrapper calculated"><span class="currency-symbol">$</span><input
                                type="text" id="capitalReinversion" readonly></div>
                    </div>
                </div>
                <div class="field-row">
                    <div class="field-item">
                        <label class="field-label">
                            GANANCIA
                            <span class="tooltip-trigger" style="background-color: #064e3b; color: #ecfdf5;">
                                i
                                <span class="tooltip-text">Resultado neto de la inversi√≥n despu√©s de la venta del
                                    inmueble.</span>
                            </span>
                        </label>
                        <div class="field-input-wrapper calculated"><span class="currency-symbol">$</span><input
                                type="text" id="ganancia" readonly></div>
                    </div>
                    <div class="field-item">
                        <label class="field-label">
                            Rentabilidad (ROI)
                            <span class="tooltip-trigger" style="background-color: #064e3b; color: #ecfdf5;">
                                i
                                <span class="tooltip-text">Mide la rentabilidad generada frente al capital invertido.
                                    Este indicador no tiene en cuenta el tiempo en que se obtiene el resultado.</span>
                            </span>
                        </label>
                        <div class="field-input-wrapper calculated"><input type="text"
                                id="roi" readonly><span class="percent-symbol">%</span></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MAPA DE RENTABILIDAD -->
        <div id="mapaRentabilidad" class="glass rounded-3xl p-8 mb-6 border border-slate-100">
            <h2 class="text-2xl font-bold mb-2 text-slate-800 text-center uppercase">MAPA DE RENTABILIDAD</h2>
            <p class="text-center text-slate-600 mb-8 font-medium">Zonas de Calor - An√°lisis de Rentabilidad</p>

            <!-- Barra de zonas de calor -->
            <div class="relative h-24 rounded-xl overflow-visible shadow-lg mb-12">
                <div
                    class="absolute left-0 top-0 bottom-0 w-[30%] bg-gradient-to-r from-green-600 via-green-500 to-green-400 flex items-center justify-center">
                    <div class="text-center text-white">
                        <p class="font-bold text-lg">Zona Verde</p>
                    </div>
                </div>
                <div
                    class="absolute left-[30%] top-0 bottom-0 w-[40%] bg-gradient-to-r from-yellow-500 via-yellow-400 to-yellow-300 flex items-center justify-center">
                    <div class="text-center text-white">
                        <p class="font-bold text-lg">Zona Amarilla</p>
                    </div>
                </div>
                <div
                    class="absolute right-0 top-0 bottom-0 w-[30%] bg-gradient-to-r from-orange-500 via-orange-400 to-orange-300 flex items-center justify-center">
                    <div class="text-center text-white">
                        <p class="font-bold text-lg">Zona Naranja</p>
                    </div>
                </div>

                <div id="indicadorPosicion"
                    class="absolute top-0 bottom-0 w-1 bg-slate-800 z-10 transition-all duration-300"
                    style="left: 50%; box-shadow: 0 0 20px rgba(15,23,42,0.5);">
                    <div
                        class="absolute -top-8 left-1/2 transform -translate-x-1/2 bg-slate-800 text-white px-3 py-1 rounded-lg text-sm font-bold whitespace-nowrap shadow-lg">
                        Tu ROI
                        <div
                            class="absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-slate-800">
                        </div>
                    </div>
                    <div class="absolute -bottom-8 left-1/2 transform -translate-x-1/2 bg-slate-800 text-white px-3 py-1 rounded-lg text-sm font-bold"
                        id="indicadorTiempoCesion">
                        20 meses
                    </div>
                </div>
            </div>

            <!-- Gr√°fica de ROI vs Tiempo -->
            <div class="bg-slate-50 rounded-xl p-6 border border-slate-200 mb-6">
                <h3 class="text-xl font-bold text-slate-800 mb-4 text-center">ROI vs Tiempo de Inversi√≥n</h3>

                <div class="relative h-64">
                    <div
                        class="absolute left-0 top-0 bottom-8 w-16 flex flex-col justify-between text-right pr-2 text-sm font-medium text-slate-600">
                        <span id="ejeY3">50%</span>
                        <span id="ejeY2">33%</span>
                        <span id="ejeY1">17%</span>
                        <span>0%</span>
                    </div>

                    <div class="absolute left-16 right-0 top-0 bottom-8 border-l-2 border-b-2 border-slate-300">
                        <div class="absolute left-0 right-0 top-0 border-b border-slate-200"></div>
                        <div class="absolute left-0 right-0 top-1/3 border-b border-slate-200"></div>
                        <div class="absolute left-0 right-0 top-2/3 border-b border-slate-200"></div>

                        <!-- Zonas horizontales basadas en ROI: Verde ‚â•20%, Amarilla 10-20%, Naranja <10% -->
                        <!-- Para escala t√≠pica de 35-50%: Verde ~60%, Amarilla ~20%, Naranja ~20% -->
                        <div class="absolute left-0 right-0 top-0 h-[60%] bg-green-500 opacity-20"></div>
                        <div class="absolute left-0 right-0 top-[60%] h-[20%] bg-yellow-400 opacity-20"></div>
                        <div class="absolute left-0 right-0 bottom-0 h-[20%] bg-orange-400 opacity-20"></div>

                        <div id="puntoCesion"
                            class="absolute w-5 h-5 bg-slate-800 rounded-full border-4 border-white shadow-lg transform -translate-x-1/2 -translate-y-1/2 z-10"
                            style="left: 50%; top: 50%;">
                            <div
                                class="absolute -top-14 left-1/2 transform -translate-x-1/2 bg-slate-800 text-white px-4 py-2 rounded-lg text-sm font-bold whitespace-nowrap shadow-xl">
                                <span id="roiTooltip">ROI: 0%</span>
                                <div
                                    class="absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-slate-800">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div
                        class="absolute left-16 right-0 bottom-0 h-8 flex justify-between items-start pt-2 text-sm font-medium text-slate-600">
                        <span>0m</span>
                        <span class="text-green-600">12m</span>
                        <span class="text-yellow-600">24m</span>
                        <span class="text-orange-600">40m</span>
                    </div>
                </div>
            </div>

            <!-- Leyenda -->
            <div class="grid md:grid-cols-3 gap-4 mb-6">
                <div class="bg-gradient-to-br from-green-50 to-green-100 border border-green-200 rounded-xl p-4">
                    <div class="flex items-center gap-2 mb-2">
                        <div class="w-4 h-4 bg-green-600 rounded"></div>
                        <h4 class="font-bold text-green-800">Zona Verde</h4>
                    </div>
                    <p class="text-sm text-green-700">ROI ‚â• 20%. Inversi√≥n atractiva con excelente retorno del capital invertido.</p>
                </div>

                <div class="bg-gradient-to-br from-yellow-50 to-yellow-100 border border-yellow-200 rounded-xl p-4">
                    <div class="flex items-center gap-2 mb-2">
                        <div class="w-4 h-4 bg-yellow-500 rounded"></div>
                        <h4 class="font-bold text-yellow-800">Zona Amarilla</h4>
                    </div>
                    <p class="text-sm text-yellow-700">ROI 10-20%. Balance razonable entre rentabilidad y capital invertido.
                    </p>
                </div>

                <div class="bg-gradient-to-br from-orange-50 to-orange-100 border border-orange-200 rounded-xl p-4">
                    <div class="flex items-center gap-2 mb-2">
                        <div class="w-4 h-4 bg-orange-600 rounded"></div>
                        <h4 class="font-bold text-orange-800">Zona Naranja</h4>
                    </div>
                    <p class="text-sm text-orange-700">ROI < 10%. Rentabilidad baja, eval√∫a la viabilidad de la inversi√≥n.</p>
                </div>
            </div>

            <!-- An√°lisis personalizado -->
            <div id="analisisPersonalizado"
                class="rounded-xl p-6 border-2 bg-gradient-to-br from-yellow-50 to-yellow-100 border-yellow-300">
                <h4 class="text-xl font-bold mb-3 flex items-center gap-2">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                    </svg>
                    AN√ÅLISIS DE TU INVERSI√ìN
                </h4>
                <div class="space-y-2 text-gray-800" id="textoAnalisis">
                    <p class="font-medium">Cargando an√°lisis...</p>
                </div>
            </div>
        </div>

        <!-- 7. DISCLAIMER -->
        <div class="bg-amber-50 border-l-4 border-amber-500 rounded-xl p-6 mb-8">
            <h4 class="font-bold text-amber-900 mb-2 flex items-center gap-2">‚ö† NOTA IMPORTANTE:</h4>
            <p class="text-amber-800 text-xs text-justify">
                Este an√°lisis es una herramienta de apoyo financiero elaborada con fines informativos y educativos. No
                reemplaza la revisi√≥n del inmueble, el an√°lisis legal ni la validaci√≥n de las condiciones del cr√©dito
                hipotecario. Los resultados dependen de los supuestos ingresados y pueden variar seg√∫n el mercado.
            </p>
        </div>
    </div>

    <script>
        function formatNumberInput(value) { return value.toString().replace(/\D/g, '').replace(/\B(?=(\d{3})+(?!\d))/g, '.'); }
        function parseFormattedNumber(value) { return parseFloat(value.toString().replace(/\./g, '')) || 0; }

        function calcular() {
            // 1. Datos Compra
            let pCompra = parseFormattedNumber(document.getElementById('precioCompra').value);
            let area = parseFloat(document.getElementById('areaM2').value) || 1;
            let costoMejoras = parseFormattedNumber(document.getElementById('costoMejoras').value);
            let perEscCompra = parseFloat(document.getElementById('porcentajeEscrituracionCompra').value) || 0;
            let perFinanciacion = parseFloat(document.getElementById('porcentajeFinanciacion').value) || 0;

            let costosEscCompra = Math.round(pCompra * (perEscCompra / 100));
            // C√°lculo Cuota Inicial basado en % Financiaci√≥n
            let valorCredito = Math.round(pCompra * (perFinanciacion / 100));
            let vCI = pCompra - valorCredito;

            // 2. Financiaci√≥n
            let plazo = parseInt(document.getElementById('plazoAnos').value) || 1;
            let tasaEA = parseFloat(document.getElementById('tasaEA').value) || 0;
            let tasaEM = Math.pow(1 + (tasaEA / 100), 1 / 12) - 1;
            let nPer = plazo * 12;
            let cuotaH = Math.round(valorCredito * (tasaEM / (1 - Math.pow(1 + tasaEM, -nPer))));

            // 3. Tenencia
            let admin = parseFormattedNumber(document.getElementById('administracionMensual').value);
            let serv = parseFormattedNumber(document.getElementById('serviciosPublicosMensual').value);
            let otrosTen = parseFormattedNumber(document.getElementById('otrosCostosMes').value);
            let tenenciaMes = admin + serv + otrosTen;

            // 4. Salida
            let pVenta = parseFormattedNumber(document.getElementById('precioVentaEsperado').value);
            let mesVenta = parseInt(document.getElementById('mesEstimadoVenta').value) || 0;
            let costoTenenciaAcum = (cuotaH + tenenciaMes) * mesVenta;
            let valorizacion = (pCompra > 0) ? ((pVenta / pCompra) - 1) : 0;
            let perEscVenta = parseFloat(document.getElementById('porcentajeEscrituracionVenta').value) || 0;
            let costosEscVenta = Math.round(pVenta * (perEscVenta / 100));
            let otrosCostosVenta = parseFormattedNumber(document.getElementById('otrosCostosVenta').value);

            // Saldo Remanente del Cr√©dito
            let factorN = Math.pow(1 + tasaEM, nPer);
            let factorP = Math.pow(1 + tasaEM, mesVenta);
            let saldoCreditoVenta = valorCredito * (factorN - factorP) / (factorN - 1);
            if (saldoCreditoVenta < 0) saldoCreditoVenta = 0;

            // 5. Resultados
            // Capital Invertido: CI + Escrituras Compra + Mejoras + Tenencia Acumulada + Otros Costos Venta
            let capitalInv = vCI + costosEscCompra + costoMejoras + costoTenenciaAcum + otrosCostosVenta;

            // Ganancia: Venta - Saldo Credito - Costos Venta (Escrituras) - Capital Invertido
            let ganancia = pVenta - saldoCreditoVenta - costosEscVenta - capitalInv;

            let roi = (capitalInv > 0) ? (ganancia / capitalInv) : 0;
            let capitalReinv = capitalInv + ganancia;

            // Set Values
            document.getElementById('valorM2').value = formatNumberInput(Math.round(pCompra / area));
            document.getElementById('costosEscrituracionCompra').value = formatNumberInput(costosEscCompra);
            document.getElementById('valorCuotaInicial').value = formatNumberInput(vCI);
            document.getElementById('valorCredito').value = formatNumberInput(valorCredito);

            document.getElementById('tasaEM').value = (tasaEM * 100).toFixed(2);
            document.getElementById('cuotaMensual').value = formatNumberInput(cuotaH);

            document.getElementById('costoTotalTenenciaMensual').value = formatNumberInput(tenenciaMes);

            document.getElementById('costoTenenciaAcumulado').value = formatNumberInput(Math.round(costoTenenciaAcum));
            document.getElementById('valorizacion').value = (valorizacion * 100).toFixed(2);
            document.getElementById('costosEscrituracionVenta').value = formatNumberInput(costosEscVenta);
            document.getElementById('saldoCreditoVenta').value = formatNumberInput(Math.round(saldoCreditoVenta));

            document.getElementById('capitalTotalInvertido').value = formatNumberInput(Math.round(capitalInv));
            document.getElementById('ganancia').value = formatNumberInput(Math.round(ganancia));
            document.getElementById('capitalReinversion').value = formatNumberInput(Math.round(capitalReinv));
            document.getElementById('roi').value = (roi * 100).toFixed(2);

            analizarResultados(roi * 100, mesVenta, Math.round(costoTenenciaAcum), Math.round(capitalInv));
        }

        function analizarResultados(roiVal, meses, costoTenencia, capitalInv) {
            const map = document.getElementById('mapaRentabilidad');
            const resNeg = document.getElementById('resultadoNegativo');

            if (roiVal < 0) {
                resNeg.classList.remove('hidden');
                map.classList.add('hidden');
                return;
            } else {
                resNeg.classList.add('hidden');
                map.classList.remove('hidden');
            }

            let titulo = "", msg = "", colorCls = "";
            let pctTenencia = (capitalInv > 0) ? ((costoTenencia / capitalInv) * 100).toFixed(1) : "0";
            let posPunto = 0;

            // UMBRALES: Green >= 20, Yellow 10-19, Orange < 10
            if (roiVal >= 20) {
                titulo = "Inversi√≥n Atractiva. Con buen desempe√±o con respecto al capital invertido.";
                msg = `Con un tiempo de Inversi√≥n de ${meses} meses, esta operaci√≥n se ubica en la Zona Verde. Este nivel de ROI corresponde a oportunidades que permiten acelerar el crecimiento del capital y avanzar m√°s r√°pido en la ruta del inversionista.<br><br><strong>Costo de Tenencia Actual: $${formatNumberInput(costoTenencia)} (${pctTenencia}% Del total de Capital Invertido)</strong>`;
                colorCls = "bg-gradient-to-br from-green-50 to-green-100 border-green-300";
                posPunto = 15;
            } else if (roiVal >= 10) {
                titulo = "ROI SALUDABLE. Inversi√≥n que genera valor y recupera el capital con utilidad razonable.";
                msg = `Con un tiempo de Inversi√≥n de ${meses} meses, esta operaci√≥n se ubica en la Zona Amarilla. Balance entre rentabilidad y tiempo. Frente a alternativas tradicionales, este ROI representa una inversi√≥n inmobiliaria competitiva.<br><br><strong>Costo de Tenencia Actual: $${formatNumberInput(costoTenencia)} (${pctTenencia}% Del total de Capital Invertido)</strong>`;
                colorCls = "bg-gradient-to-br from-yellow-50 to-yellow-100 border-yellow-300";
                posPunto = 50;
            } else {
                titulo = "BAJO Retorno de la Inversi√≥n. Eval√∫a la rentabilidad y verifica el cumplimiento del objetivo.";
                msg = `Con un tiempo de Inversi√≥n de ${meses} meses, esta operaci√≥n se ubica en la Zona Naranja. Rentabilidad baja respecto al capital aportado, con costos que afectan significativamente la eficiencia de la inversi√≥n. 'La inversi√≥n trabaja m√°s para el banco que para el inversionista.'<br><br><strong>Costo de Tenencia Actual: $${formatNumberInput(costoTenencia)} (${pctTenencia}% Del total de Capital Invertido)</strong>`;
                colorCls = "bg-gradient-to-br from-orange-50 to-orange-100 border-orange-300";
                posPunto = 85;
            }

            document.getElementById('indicadorPosicion').style.left = posPunto + "%";
            document.getElementById('indicadorTiempoCesion').textContent = roiVal.toFixed(2) + '%';
            const box = document.getElementById('analisisPersonalizado');
            box.className = `rounded-xl p-6 border-2 ${colorCls}`;
            document.getElementById('textoAnalisis').innerHTML = `<p class="font-bold mb-2">${titulo}</p><p>${msg}</p>`;

            // CHART ROI vs TIEMPO
            // Calculate max ROI for graph scale
            let maxRoiGraph = Math.max(50, Math.ceil(roiVal * 1.2));

            // Time scale based on meses (0-40 months scale from source)
            let maxMeses = 40;
            let xPct = Math.min(100, (meses / maxMeses) * 100);
            let yPct = Math.min(100, (roiVal / maxRoiGraph) * 100);

            document.getElementById('puntoCesion').style.left = xPct + "%";
            document.getElementById('puntoCesion').style.top = (100 - yPct) + "%";
            document.getElementById('roiTooltip').innerText = "ROI: " + roiVal.toFixed(2) + "%";

            // Update Y-axis labels to show proper scale
            document.getElementById('ejeY3').innerText = maxRoiGraph + "%";
            document.getElementById('ejeY2').innerText = Math.round(maxRoiGraph * 2/3) + "%";
            document.getElementById('ejeY1').innerText = Math.round(maxRoiGraph * 1/3) + "%";
        }

        async function descargarPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'mm', 'a4');

            // Configuraci√≥n de colores
            const colorPrimario = [15, 23, 42]; // #0f172a
            const colorSecundario = [100, 116, 139]; // #64748b
            const colorVerde = [134, 239, 172]; // #86efac
            const colorFondoClaro = [248, 250, 252]; // #f8fafc

            let yPosition = 20;
            const margenIzq = 20;
            const margenDer = 190;
            const anchoUtil = margenDer - margenIzq;

            try {
                // Cargar y agregar el logo
                const logoUrl = 'https://storage.googleapis.com/msgsndr/e3ptBMQArqbC3YL2ik2n/media/69467d01106fdc3c581d774f.png';
                const imgData = await cargarImagenBase64(logoUrl);

                // Calcular dimensiones manteniendo proporci√≥n
                const maxLogoWidth = 60;
                const maxLogoHeight = 30;
                const img = await cargarImagen(logoUrl);
                const aspectRatio = img.width / img.height;

                let logoWidth = maxLogoWidth;
                let logoHeight = maxLogoWidth / aspectRatio;

                if (logoHeight > maxLogoHeight) {
                    logoHeight = maxLogoHeight;
                    logoWidth = maxLogoHeight * aspectRatio;
                }

                const logoX = (210 - logoWidth) / 2;
                doc.addImage(imgData, 'PNG', logoX, yPosition, logoWidth, logoHeight);
                yPosition += logoHeight + 10;
            } catch (error) {
                console.log('No se pudo cargar el logo, continuando sin √©l');
                yPosition += 5;
            }

            // T√≠tulo principal
            doc.setFillColor(...colorPrimario);
            doc.rect(margenIzq, yPosition, anchoUtil, 25, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(18);
            doc.setFont('helvetica', 'bold');
            doc.text('SIMULADOR DE RENTABILIDAD CRECE', 105, yPosition + 8, { align: 'center' });
            doc.setFontSize(12);
            doc.setFont('helvetica', 'normal');
            doc.text('INVERSI√ìN EN INMUEBLES USADOS', 105, yPosition + 15, { align: 'center' });
            doc.setFontSize(10);
            doc.text('Estrategia: Comprar con Financiaci√≥n, Mejorar y Vender', 105, yPosition + 21, { align: 'center' });
            yPosition += 27;

            // Nombre del Proyecto (si se ingres√≥)
            const nombreProyecto = document.getElementById('nombreProyecto').value.trim();
            if (nombreProyecto) {
                doc.setFillColor(241, 245, 249);
                doc.roundedRect(margenIzq, yPosition, anchoUtil, 8, 2, 2, 'F');
                doc.setTextColor(51, 65, 85);
                doc.setFontSize(10); doc.setFont('helvetica', 'bold');
                doc.text(nombreProyecto, 105, yPosition + 5.5, { align: 'center' });
                yPosition += 12;
            } else {
                yPosition += 8;
            }

            // Funci√≥n para verificar salto de p√°gina
            function checkPageBreak(altura) {
                if (yPosition + altura > 270) {
                    doc.addPage();
                    yPosition = 20;
                    return true;
                }
                return false;
            }

            // Obtener valores actuales
            const precioCompra = parseFormattedNumber(document.getElementById('precioCompra').value);
            const areaM2 = document.getElementById('areaM2').value;
            const valorM2 = document.getElementById('valorM2').value;
            const costoMejoras = parseFormattedNumber(document.getElementById('costoMejoras').value);
            const porcentajeEscrituracionCompra = document.getElementById('porcentajeEscrituracionCompra').value;
            const costosEscrituracionCompra = document.getElementById('costosEscrituracionCompra').value;
            const porcentajeFinanciacion = document.getElementById('porcentajeFinanciacion').value;
            const valorCuotaInicial = document.getElementById('valorCuotaInicial').value;
            const valorCredito = document.getElementById('valorCredito').value;

            const plazoAnos = document.getElementById('plazoAnos').value;
            const tasaEA = document.getElementById('tasaEA').value;
            const tasaEM = document.getElementById('tasaEM').value;
            const cuotaMensual = document.getElementById('cuotaMensual').value;

            const administracionMensual = parseFormattedNumber(document.getElementById('administracionMensual').value);
            const serviciosPublicosMensual = parseFormattedNumber(document.getElementById('serviciosPublicosMensual').value);
            const otrosCostosMes = parseFormattedNumber(document.getElementById('otrosCostosMes').value);
            const costoTotalTenenciaMensual = document.getElementById('costoTotalTenenciaMensual').value;

            const precioVentaEsperado = parseFormattedNumber(document.getElementById('precioVentaEsperado').value);
            const mesEstimadoVenta = document.getElementById('mesEstimadoVenta').value;
            const costoTenenciaAcumulado = document.getElementById('costoTenenciaAcumulado').value;
            const valorizacion = document.getElementById('valorizacion').value;
            const porcentajeEscrituracionVenta = document.getElementById('porcentajeEscrituracionVenta').value;
            const costosEscrituracionVenta = document.getElementById('costosEscrituracionVenta').value;
            const saldoCreditoVenta = document.getElementById('saldoCreditoVenta').value;
            const otrosCostosVenta = parseFormattedNumber(document.getElementById('otrosCostosVenta').value);

            const capitalTotalInvertido = document.getElementById('capitalTotalInvertido').value;
            const ganancia = document.getElementById('ganancia').value;
            const roi = document.getElementById('roi').value;
            const capitalReinversion = document.getElementById('capitalReinversion').value;

            const capitalInvertidoNum = parseFormattedNumber(capitalTotalInvertido);
            const gananciaNum = parseFormattedNumber(ganancia);
            const roiNum = parseFloat(roi);

            // Secci√≥n 1: DATOS DE COMPRA DEL INMUEBLE
            doc.setFillColor(...colorFondoClaro);
            doc.rect(margenIzq, yPosition, anchoUtil, 8, 'F');
            doc.setTextColor(...colorPrimario);
            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.text('DATOS DE COMPRA DEL INMUEBLE', margenIzq + 3, yPosition + 6);
            yPosition += 12;

            const datosCompra = [
                ['Precio de Compra', '$' + formatNumberInput(precioCompra.toString())],
                ['√Årea del Inmueble (M¬≤)', areaM2 + ' M¬≤'],
                ['Valor por M¬≤', '$' + valorM2],
                ['Costo de Mejoras o Remodelaci√≥n', '$' + formatNumberInput(costoMejoras.toString())],
                ['% Costos de Escrituraci√≥n (Compra)', porcentajeEscrituracionCompra + '%'],
                ['Costos de Escrituraci√≥n por Compra', '$' + costosEscrituracionCompra],
                ['% Financiaci√≥n (Cr√©dito)', porcentajeFinanciacion + '%'],
                ['Valor de la Cuota Inicial', '$' + valorCuotaInicial],
                ['Valor del Cr√©dito Hipotecario', '$' + valorCredito]
            ];

            doc.autoTable({
                startY: yPosition,
                head: [],
                body: datosCompra,
                theme: 'grid',
                margin: { left: margenIzq, right: 20 },
                styles: {
                    fontSize: 9,
                    cellPadding: 3,
                    lineColor: [200, 200, 200],
                    lineWidth: 0.1
                },
                columnStyles: {
                    0: { fontStyle: 'bold', cellWidth: 100, textColor: colorSecundario },
                    1: { cellWidth: 70, halign: 'right', fontStyle: 'bold', textColor: colorPrimario }
                },
                didParseCell: function (data) {
                    if ((data.row.index === 2 || data.row.index === 5 || data.row.index === 7 || data.row.index === 8) && data.column.index === 1) {
                        data.cell.styles.fillColor = [232, 245, 233]; // Verde claro para calculados
                    }
                }
            });

            yPosition = doc.lastAutoTable.finalY + 10;

            // Secci√≥n 2: FINANCIACI√ìN (Cr√©dito Hipotecario)
            checkPageBreak(40);
            doc.setFillColor(...colorFondoClaro);
            doc.rect(margenIzq, yPosition, anchoUtil, 8, 'F');
            doc.setTextColor(...colorPrimario);
            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.text('FINANCIACI√ìN (Cr√©dito Hipotecario)', margenIzq + 3, yPosition + 6);
            yPosition += 12;

            const datosFinanciacion = [
                ['Plazo del Cr√©dito (A√±os)', plazoAnos + ' a√±os'],
                ['Tasa Efectiva Anual (E.A.)', tasaEA + '%'],
                ['Tasa Efectiva Mensual (E.M.)', tasaEM + '%'],
                ['Cuota Mensual del Cr√©dito (Sin Seguros)', '$' + cuotaMensual]
            ];

            doc.autoTable({
                startY: yPosition,
                head: [],
                body: datosFinanciacion,
                theme: 'grid',
                margin: { left: margenIzq, right: 20 },
                styles: {
                    fontSize: 9,
                    cellPadding: 3,
                    lineColor: [200, 200, 200],
                    lineWidth: 0.1
                },
                columnStyles: {
                    0: { fontStyle: 'bold', cellWidth: 100, textColor: colorSecundario },
                    1: { cellWidth: 70, halign: 'right', fontStyle: 'bold', textColor: colorPrimario }
                },
                didParseCell: function (data) {
                    if ((data.row.index === 2 || data.row.index === 3) && data.column.index === 1) {
                        data.cell.styles.fillColor = [232, 245, 233]; // Verde claro para calculados
                    }
                }
            });

            yPosition = doc.lastAutoTable.finalY + 10;

            // Secci√≥n 3: COSTOS MENSUALES DE TENENCIA
            checkPageBreak(40);
            doc.setFillColor(...colorFondoClaro);
            doc.rect(margenIzq, yPosition, anchoUtil, 8, 'F');
            doc.setTextColor(...colorPrimario);
            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.text('COSTOS MENSUALES DE TENENCIA', margenIzq + 3, yPosition + 6);
            yPosition += 12;

            const datosTenencia = [
                ['Administraci√≥n Mensual', '$' + formatNumberInput(administracionMensual.toString())],
                ['Servicios P√∫blicos Mensual', '$' + formatNumberInput(serviciosPublicosMensual.toString())],
                ['Otros Costos del Mes', '$' + formatNumberInput(otrosCostosMes.toString())],
                ['Costo Total de Tenencia Mensual', '$' + costoTotalTenenciaMensual]
            ];

            doc.autoTable({
                startY: yPosition,
                head: [],
                body: datosTenencia,
                theme: 'grid',
                margin: { left: margenIzq, right: 20 },
                styles: {
                    fontSize: 9,
                    cellPadding: 3,
                    lineColor: [200, 200, 200],
                    lineWidth: 0.1
                },
                columnStyles: {
                    0: { fontStyle: 'bold', cellWidth: 100, textColor: colorSecundario },
                    1: { cellWidth: 70, halign: 'right', fontStyle: 'bold', textColor: colorPrimario }
                },
                didParseCell: function (data) {
                    if (data.row.index === 3 && data.column.index === 1) {
                        data.cell.styles.fillColor = [232, 245, 233]; // Verde claro para calculados
                    }
                }
            });

            yPosition = doc.lastAutoTable.finalY + 10;

            // Secci√≥n 4: SALIDA POR VENTA
            checkPageBreak(50);
            doc.setFillColor(...colorFondoClaro);
            doc.rect(margenIzq, yPosition, anchoUtil, 8, 'F');
            doc.setTextColor(...colorPrimario);
            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.text('SALIDA POR VENTA', margenIzq + 3, yPosition + 6);
            yPosition += 12;

            const datosVenta = [
                ['Precio de Venta Esperado', '$' + formatNumberInput(precioVentaEsperado.toString())],
                ['Mes Estimado de Venta', mesEstimadoVenta + ' meses'],
                ['Costo Tenencia Acumulado', '$' + costoTenenciaAcumulado],
                ['Valorizaci√≥n Frente al Precio de Compra', valorizacion + '%'],
                ['% Costos Escrituraci√≥n (Venta)', porcentajeEscrituracionVenta + '%'],
                ['Costos Escrituraci√≥n por Venta', '$' + costosEscrituracionVenta],
                ['Saldo Cr√©dito al Momento Venta', '$' + saldoCreditoVenta],
                ['Otros Costos Venta', '$' + formatNumberInput(otrosCostosVenta.toString())]
            ];

            doc.autoTable({
                startY: yPosition,
                head: [],
                body: datosVenta,
                theme: 'grid',
                margin: { left: margenIzq, right: 20 },
                styles: {
                    fontSize: 9,
                    cellPadding: 3,
                    lineColor: [200, 200, 200],
                    lineWidth: 0.1
                },
                columnStyles: {
                    0: { fontStyle: 'bold', cellWidth: 100, textColor: colorSecundario },
                    1: { cellWidth: 70, halign: 'right', fontStyle: 'bold', textColor: colorPrimario }
                },
                didParseCell: function (data) {
                    if ((data.row.index === 2 || data.row.index === 3 || data.row.index === 5 || data.row.index === 6) && data.column.index === 1) {
                        data.cell.styles.fillColor = [232, 245, 233]; // Verde claro para calculados
                    }
                }
            });

            yPosition = doc.lastAutoTable.finalY + 10;

            // Secci√≥n 5: RESULTADOS DE LA INVERSI√ìN
            checkPageBreak(50);
            const yStartResultados = yPosition;
            const tableHeight = 32; // Altura estimada para 4 filas

            // 1. Fondo de la secci√≥n
            doc.setFillColor(220, 252, 231); // #dcfce7
            doc.setDrawColor(134, 239, 172); // #86efac
            doc.setLineWidth(0.4);
            doc.roundedRect(margenIzq, yStartResultados, anchoUtil, 10 + tableHeight, 2, 2, 'FD');

            // 2. Cabecera de la secci√≥n
            doc.setFillColor(74, 222, 128); // #4ade80
            doc.rect(margenIzq, yStartResultados, anchoUtil, 10, 'F');
            doc.setTextColor(6, 78, 59); // #064e3b
            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.text('RESULTADOS DE LA INVERSI√ìN', margenIzq + 5, yStartResultados + 7);

            const datosResultado = [
                ['CAPITAL TOTAL INVERTIDO', '$' + capitalTotalInvertido],
                ['GANANCIA NETA', '$' + ganancia],
                ['ROI', roi + '%'],
                ['CAPITAL DE REINVERSI√ìN', '$' + capitalReinversion]
            ];

            doc.autoTable({
                startY: yStartResultados + 10,
                head: [],
                body: datosResultado,
                theme: 'grid',
                margin: { left: margenIzq, right: 210 - margenDer },
                styles: {
                    fontSize: 9,
                    cellPadding: 3,
                    lineColor: [134, 239, 172], // #86efac
                    lineWidth: 0.1,
                    fillColor: [220, 252, 231] // #dcfce7
                },
                columnStyles: {
                    0: { fontStyle: 'bold', cellWidth: 100, textColor: [6, 95, 70] },
                    1: { cellWidth: 70, halign: 'right', fontStyle: 'bold', textColor: [6, 78, 59] }
                }
            });

            yPosition = doc.lastAutoTable.finalY + 15;

            // Secci√≥n 6: MAPA DE RENTABILIDAD
            if (roiNum < 0) {
                // Si ROI es negativo, no mostrar mapa
                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.setFontSize(8);
                    doc.setTextColor(...colorSecundario);
                    doc.setFont('helvetica', 'normal');
                    const footerText = 'Simulador Inmueble Usado - CRECE';
                    doc.text(footerText, 105, 285, { align: 'center' });
                    doc.text('P√°gina ' + i + ' de ' + pageCount, 105, 290, { align: 'center' });
                }
                doc.save('Simulador_InmuebleUsado.pdf');
                return;
            }

            if (yPosition > 200) {
                doc.addPage();
                yPosition = 20;
            }

            doc.setFillColor(248, 250, 252);
            doc.rect(margenIzq, yPosition, anchoUtil, 8, 'F');
            doc.setTextColor(...colorPrimario);
            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.text('MAPA DE RENTABILIDAD', margenIzq + 3, yPosition + 6);
            yPosition += 12;

            // Subt√≠tulo
            doc.setFontSize(9);
            doc.setFont('helvetica', 'normal');
            doc.setTextColor(...colorSecundario);
            doc.text('Zona de Calor - An√°lisis de Rentabilidad', margenIzq + 3, yPosition + 2);
            yPosition += 8;

            // Gr√°fica de zonas (Verde 30%, Amarilla 40%, Naranja 30%)
            const zonaWidth = anchoUtil;
            const zonaHeight = 20;
            const zonaVerdeWidth = zonaWidth * 0.30;
            const zonaAmarillaWidth = zonaWidth * 0.40;
            const zonaNaranjaWidth = zonaWidth * 0.30;

            // Zona Verde
            doc.setFillColor(34, 197, 94); // Verde
            doc.rect(margenIzq, yPosition, zonaVerdeWidth, zonaHeight, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(10);
            doc.setFont('helvetica', 'bold');
            doc.text('Zona Verde', margenIzq + zonaVerdeWidth / 2, yPosition + zonaHeight / 2 + 2, { align: 'center' });

            // Zona Amarilla
            doc.setFillColor(234, 179, 8); // Amarillo
            doc.rect(margenIzq + zonaVerdeWidth, yPosition, zonaAmarillaWidth, zonaHeight, 'F');
            doc.text('Zona Amarilla', margenIzq + zonaVerdeWidth + zonaAmarillaWidth / 2, yPosition + zonaHeight / 2 + 2, { align: 'center' });

            // Zona Naranja
            doc.setFillColor(249, 115, 22); // Naranja
            doc.rect(margenIzq + zonaVerdeWidth + zonaAmarillaWidth, yPosition, zonaNaranjaWidth, zonaHeight, 'F');
            doc.text('Zona Naranja', margenIzq + zonaVerdeWidth + zonaAmarillaWidth + zonaNaranjaWidth / 2, yPosition + zonaHeight / 2 + 2, { align: 'center' });

            // Calcular posici√≥n del indicador (basado en ROI: >= 20% verde, 10-19% amarillo, < 10% naranja)
            let porcentajePosicion;
            if (roiNum >= 20) {
                porcentajePosicion = 15; // Centro de zona verde
            } else if (roiNum >= 10) {
                porcentajePosicion = 50; // Centro de zona amarilla
            } else {
                porcentajePosicion = 85; // Centro de zona naranja
            }

            const indicadorX = margenIzq + (zonaWidth * porcentajePosicion / 100);

            // Dibujar indicador
            doc.setDrawColor(...colorPrimario);
            doc.setLineWidth(1.5);
            doc.line(indicadorX, yPosition, indicadorX, yPosition + zonaHeight);

            // Etiqueta del indicador
            doc.setFillColor(...colorPrimario);
            doc.roundedRect(indicadorX - 12, yPosition - 6, 24, 5, 1, 1, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(8);
            doc.setFont('helvetica', 'bold');
            doc.text('Tu ROI', indicadorX, yPosition - 2.5, { align: 'center' });

            doc.roundedRect(indicadorX - 12, yPosition + zonaHeight + 1, 24, 5, 1, 1, 'F');
            doc.text(roi + '%', indicadorX, yPosition + zonaHeight + 4.5, { align: 'center' });

            yPosition += zonaHeight + 15;

            // Gr√°fica de ROI vs Tiempo
            doc.setFillColor(248, 250, 252);
            doc.rect(margenIzq, yPosition, anchoUtil, 60, 'F');
            doc.setDrawColor(226, 232, 240);
            doc.rect(margenIzq, yPosition, anchoUtil, 60, 'S');

            doc.setTextColor(...colorPrimario);
            doc.setFontSize(10);
            doc.setFont('helvetica', 'bold');
            doc.text('ROI vs Tiempo de Inversi√≥n', margenIzq + anchoUtil / 2, yPosition + 7, { align: 'center' });

            const gX = margenIzq + 20;
            const gY = yPosition + 15;
            const gW = anchoUtil - 30;
            const gH = 35;

            // Ejes
            doc.setDrawColor(100, 116, 139);
            doc.setLineWidth(0.3);
            doc.line(gX, gY, gX, gY + gH); // Y
            doc.line(gX, gY + gH, gX + gW, gY + gH); // X

            // Calcular maxRoiGraph
            let maxRoiGraph = Math.max(35, Math.ceil(roiNum * 1.2));

            // Zonas de fondo en la gr√°fica (horizontales basadas en ROI)
            const threshold20 = 20 / maxRoiGraph;
            const threshold10 = 10 / maxRoiGraph;

            // Top: Green (20% to maxRoiGraph)
            const greenHeight = gH * (1 - threshold20);
            doc.setFillColor(220, 252, 231); // Verde muy claro
            doc.rect(gX, gY, gW, greenHeight, 'F');

            // Mid: Yellow (10% to 20%)
            const yellowStart = gY + greenHeight;
            const yellowHeight = gH * (threshold20 - threshold10);
            doc.setFillColor(254, 252, 232); // Amarillo muy claro
            doc.rect(gX, yellowStart, gW, yellowHeight, 'F');

            // Bot: Orange (0% to 10%)
            const orangeStart = yellowStart + yellowHeight;
            const orangeHeight = gH * threshold10;
            doc.setFillColor(255, 247, 237); // Naranja muy claro
            doc.rect(gX, orangeStart, gW, orangeHeight, 'F');

            // Etiquetas Eje Y
            doc.setFontSize(7);
            doc.setTextColor(...colorSecundario);
            doc.text(maxRoiGraph + '%', gX - 2, gY + 2, { align: 'right' });
            doc.text('20%', gX - 2, gY + greenHeight, { align: 'right' });
            doc.text('10%', gX - 2, gY + greenHeight + yellowHeight, { align: 'right' });
            doc.text('0%', gX - 2, gY + gH, { align: 'right' });

            // Etiquetas Eje X (0m, 6m, 12m, 18m)
            doc.text('0m', gX, gY + gH + 4);
            doc.text('6m', gX + gW * 0.33, gY + gH + 4);
            doc.text('12m', gX + gW * 0.66, gY + gH + 4);
            doc.text('18m', gX + gW, gY + gH + 4);

            // Punto de la inversi√≥n actual
            const meses = parseInt(mesEstimadoVenta) || 6;
            let xPct = Math.min(1, meses / 18);
            let yPct = Math.min(1, roiNum / maxRoiGraph);
            const pX = gX + (gW * xPct);
            const pY = gY + (gH * (1 - yPct));

            doc.setFillColor(...colorPrimario);
            doc.circle(pX, pY, 1.5, 'F');
            doc.setFont('helvetica', 'bold');
            doc.text('Tu ROI: ' + roi + '%', pX, pY - 3, { align: 'center' });

            yPosition += 70;

            // Leyenda de zonas
            const leyendaY = yPosition;
            const leyendaBoxWidth = (anchoUtil - 10) / 3;

            // Zona Verde - Leyenda
            doc.setFillColor(240, 253, 244);
            doc.setDrawColor(187, 247, 208);
            doc.setLineWidth(0.3);
            doc.roundedRect(margenIzq, leyendaY, leyendaBoxWidth, 20, 2, 2, 'FD');
            doc.setFillColor(34, 197, 94);
            doc.circle(margenIzq + 3, leyendaY + 4, 1.5, 'F');
            doc.setTextColor(21, 128, 61);
            doc.setFontSize(9);
            doc.setFont('helvetica', 'bold');
            doc.text('Zona Verde', margenIzq + 7, leyendaY + 5);
            doc.setFontSize(7);
            doc.setFont('helvetica', 'normal');
            const textoVerde = doc.splitTextToSize('Inversi√≥n atractiva con buen desempe√±o respecto al capital invertido.', leyendaBoxWidth - 8);
            doc.text(textoVerde, margenIzq + 3, leyendaY + 9);

            // Zona Amarilla - Leyenda
            doc.setFillColor(254, 252, 232);
            doc.setDrawColor(253, 224, 71);
            doc.roundedRect(margenIzq + leyendaBoxWidth + 5, leyendaY, leyendaBoxWidth, 20, 2, 2, 'FD');
            doc.setFillColor(234, 179, 8);
            doc.circle(margenIzq + leyendaBoxWidth + 8, leyendaY + 4, 1.5, 'F');
            doc.setTextColor(133, 77, 14);
            doc.setFontSize(9);
            doc.setFont('helvetica', 'bold');
            doc.text('Zona Amarilla', margenIzq + leyendaBoxWidth + 12, leyendaY + 5);
            doc.setFontSize(7);
            doc.setFont('helvetica', 'normal');
            const textoAmarillo = doc.splitTextToSize('ROI saludable, balance entre rentabilidad y tiempo.', leyendaBoxWidth - 8);
            doc.text(textoAmarillo, margenIzq + leyendaBoxWidth + 8, leyendaY + 9);

            // Zona Naranja - Leyenda
            doc.setFillColor(255, 247, 237);
            doc.setDrawColor(251, 146, 60);
            doc.roundedRect(margenIzq + (leyendaBoxWidth * 2) + 10, leyendaY, leyendaBoxWidth, 20, 2, 2, 'FD');
            doc.setFillColor(249, 115, 22);
            doc.circle(margenIzq + (leyendaBoxWidth * 2) + 13, leyendaY + 4, 1.5, 'F');
            doc.setTextColor(154, 52, 18);
            doc.setFontSize(9);
            doc.setFont('helvetica', 'bold');
            doc.text('Zona Naranja', margenIzq + (leyendaBoxWidth * 2) + 17, leyendaY + 5);
            doc.setFontSize(7);
            doc.setFont('helvetica', 'normal');
            const textoNaranja = doc.splitTextToSize('Bajo retorno. Eval√∫a la rentabilidad y verifica el cumplimiento del objetivo.', leyendaBoxWidth - 8);
            doc.text(textoNaranja, margenIzq + (leyendaBoxWidth * 2) + 13, leyendaY + 9);

            yPosition += 30;

            // An√°lisis personalizado
            let zonaTexto = '';
            let colorFondo = [];
            let colorBorde = [];
            let colorTexto = [];
            let mensaje = '';

            if (roiNum >= 20) {
                zonaTexto = 'Zona Verde';
                colorFondo = [240, 253, 244];
                colorBorde = [34, 197, 94];
                colorTexto = [21, 128, 61];
                mensaje = `Con un tiempo de Inversi√≥n de ${mesEstimadoVenta} meses, esta operaci√≥n se ubica en la Zona Verde. Este nivel de ROI corresponde a oportunidades que permiten acelerar el crecimiento del capital y avanzar m√°s r√°pido en la ruta del inversionista. Inversi√≥n Atractiva con buen desempe√±o con respecto al capital invertido.`;
            } else if (roiNum >= 10) {
                zonaTexto = 'Zona Amarilla';
                colorFondo = [254, 252, 232];
                colorBorde = [234, 179, 8];
                colorTexto = [133, 77, 14];
                mensaje = `Con un tiempo de Inversi√≥n de ${mesEstimadoVenta} meses, esta operaci√≥n se ubica en la Zona Amarilla. ROI SALUDABLE. Inversi√≥n que genera valor y recupera el capital con utilidad razonable. Balance entre rentabilidad y tiempo. Frente a alternativas tradicionales, este ROI representa una inversi√≥n inmobiliaria competitiva.`;
            } else {
                zonaTexto = 'Zona Naranja';
                colorFondo = [255, 247, 237];
                colorBorde = [249, 115, 22];
                colorTexto = [154, 52, 18];
                mensaje = `Con un tiempo de Inversi√≥n de ${mesEstimadoVenta} meses, esta operaci√≥n se ubica en la Zona Naranja. BAJO Retorno de la Inversi√≥n. Eval√∫a la rentabilidad y verifica el cumplimiento del objetivo. Rentabilidad baja respecto al capital aportado, con costos que afectan significativamente la eficiencia de la inversi√≥n.`;
            }

            doc.setFillColor(...colorFondo);
            doc.setDrawColor(...colorBorde);
            doc.setLineWidth(0.5);
            doc.roundedRect(margenIzq, yPosition, anchoUtil, 30, 2, 2, 'FD');

            doc.setTextColor(...colorTexto);
            doc.setFontSize(10);
            doc.setFont('helvetica', 'bold');
            doc.text('AN√ÅLISIS DE TU INVERSI√ìN', margenIzq + 3, yPosition + 5);

            doc.setFontSize(8);
            doc.setFont('helvetica', 'normal');
            const mensajeLines = doc.splitTextToSize(mensaje, anchoUtil - 6);
            doc.text(mensajeLines, margenIzq + 3, yPosition + 10);

            yPosition += 40;

            // Disclaimer
            if (yPosition > 240) {
                doc.addPage();
                yPosition = 20;
            }

            doc.setFillColor(255, 251, 235); // Amarillo claro
            doc.rect(margenIzq, yPosition, anchoUtil, 30, 'F');
            doc.setDrawColor(245, 158, 11); // Borde amarillo
            doc.setLineWidth(0.5);
            doc.rect(margenIzq, yPosition, anchoUtil, 30, 'S');

            doc.setTextColor(120, 53, 15); // Texto √°mbar oscuro
            doc.setFontSize(10);
            doc.setFont('helvetica', 'bold');
            doc.text('NOTA IMPORTANTE:', margenIzq + 3, yPosition + 6);
            doc.setFontSize(8);
            doc.setFont('helvetica', 'normal');
            const disclaimerText = 'Este an√°lisis es una herramienta de apoyo financiero elaborada con fines informativos y educativos. No reemplaza la revisi√≥n del inmueble, el an√°lisis legal ni la validaci√≥n de las condiciones del cr√©dito hipotecario. Los resultados dependen de los supuestos ingresados y pueden variar seg√∫n el mercado.';
            const disclaimerLines = doc.splitTextToSize(disclaimerText, anchoUtil - 6);
            doc.text(disclaimerLines, margenIzq + 3, yPosition + 12);

            // Pie de p√°gina
            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.setFontSize(8);
                doc.setTextColor(...colorSecundario);
                doc.setFont('helvetica', 'normal');
                const footerText = 'Simulador Inmueble Usado - CRECE';
                doc.text(footerText, 105, 285, { align: 'center' });
                doc.text('P√°gina ' + i + ' de ' + pageCount, 105, 290, { align: 'center' });
            }

            // Descargar el PDF
            const fecha = new Date().toLocaleDateString('es-CO').replace(/\//g, '-');
            doc.save(`Simulador_InmuebleUsado_${fecha}.pdf`);
        }

        // Funci√≥n auxiliar para cargar imagen
        function cargarImagen(url) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.crossOrigin = 'Anonymous';
                img.onload = function () {
                    resolve(img);
                };
                img.onerror = reject;
                img.src = url;
            });
        }

        // Funci√≥n auxiliar para cargar imagen como base64
        function cargarImagenBase64(url) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.crossOrigin = 'Anonymous';
                img.onload = function () {
                    const canvas = document.createElement('canvas');
                    canvas.width = img.width;
                    canvas.height = img.height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0);
                    try {
                        const dataURL = canvas.toDataURL('image/png');
                        resolve(dataURL);
                    } catch (e) {
                        reject(e);
                    }
                };
                img.onerror = reject;
                img.src = url;
            });
        }

        document.querySelectorAll('input').forEach(i => i.addEventListener('input', (e) => {
            if (e.target.type === 'text' && e.target.id !== 'nombreProyecto') {
                e.target.value = formatNumberInput(e.target.value);
            }
            if (e.target.id !== 'nombreProyecto') {
                calcular();
            }
        }));
        window.onload = calcular;
    </script>
</body>

</html>