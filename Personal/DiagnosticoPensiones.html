<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="theme-color" content="#1a5f7a">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Diagn√≥stico para Asesor√≠a de Pensiones IMSS</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(36, 182, 145, 0.15) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            box-shadow:
                0 8px 32px rgba(0, 0, 0, 0.12),
                0 2px 8px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            position: relative;
            z-index: 1;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .header {
            background: linear-gradient(135deg, #1a5f7a 0%, #159895 50%, #24b691 100%);
            color: white;
            padding: 48px 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                radial-gradient(circle at 30% 20%, rgba(255, 255, 255, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 70% 80%, rgba(255, 255, 255, 0.05) 0%, transparent 50%);
            pointer-events: none;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 12px;
            font-weight: 700;
            letter-spacing: -0.5px;
            position: relative;
            z-index: 1;
        }

        .header p {
            font-size: 16px;
            opacity: 0.95;
            line-height: 1.7;
            font-weight: 400;
            position: relative;
            z-index: 1;
            max-width: 700px;
            margin: 0 auto;
        }

        .form-container {
            padding: 48px 40px;
        }

        .form-section {
            margin-bottom: 36px;
            padding-bottom: 36px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.06);
        }

        .form-section:last-child {
            border-bottom: none;
        }

        .section-title {
            color: #1a5f7a;
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 24px;
            padding-bottom: 12px;
            border-bottom: 3px solid #24b691;
            letter-spacing: -0.3px;
            display: inline-block;
            position: relative;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 40%;
            height: 3px;
            background: linear-gradient(90deg, #159895, transparent);
        }

        .form-group {
            margin-bottom: 24px;
        }

        label {
            display: block;
            margin-bottom: 10px;
            color: #1a1a1a;
            font-weight: 600;
            font-size: 14px;
            letter-spacing: -0.1px;
        }

        label .required {
            color: #ef4444;
            margin-left: 4px;
            font-weight: 700;
        }

        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="date"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: inherit;
            background: #fafafa;
            color: #1a1a1a;
            font-weight: 400;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #24b691;
            box-shadow: 0 0 0 4px rgba(36, 182, 145, 0.1);
            background: white;
        }

        input:hover:not(:focus),
        select:hover:not(:focus),
        textarea:hover:not(:focus) {
            border-color: #cbd5e1;
            background: white;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
            line-height: 1.6;
        }

        .radio-group,
        .scale-group {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        .radio-option {
            display: flex;
            align-items: center;
            padding: 10px 16px;
            background: #f8fafc;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .radio-option:hover {
            background: white;
            border-color: #cbd5e1;
        }

        .radio-option:has(input:checked) {
            background: linear-gradient(135deg, rgba(26, 95, 122, 0.08) 0%, rgba(36, 182, 145, 0.08) 100%);
            border-color: #24b691;
        }

        .radio-option input[type="radio"] {
            width: auto;
            margin-right: 8px;
            cursor: pointer;
            accent-color: #24b691;
        }

        .radio-option label {
            cursor: pointer;
            font-weight: 500;
            color: #475569;
        }

        .scale-group {
            justify-content: space-between;
            margin-top: 12px;
        }

        .scale-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 12px;
            background: #f8fafc;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 60px;
        }

        .scale-option:hover {
            background: white;
            border-color: #cbd5e1;
        }

        .scale-option:has(input:checked) {
            background: linear-gradient(135deg, rgba(26, 95, 122, 0.08) 0%, rgba(36, 182, 145, 0.08) 100%);
            border-color: #24b691;
        }

        .scale-option input[type="radio"] {
            width: auto;
            cursor: pointer;
            accent-color: #24b691;
        }

        .scale-option label {
            margin: 0;
            font-size: 13px;
            font-weight: 600;
            color: #475569;
            cursor: pointer;
        }

        .btn-container {
            display: flex;
            gap: 16px;
            margin-top: 40px;
        }

        .btn {
            flex: 1;
            padding: 16px 32px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            letter-spacing: -0.2px;
            font-family: 'Inter', sans-serif;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(135deg, #1a5f7a 0%, #159895 50%, #24b691 100%);
            color: white;
            box-shadow:
                0 4px 12px rgba(36, 182, 145, 0.25),
                0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.15) 0%, transparent 100%);
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow:
                0 8px 24px rgba(36, 182, 145, 0.35),
                0 2px 6px rgba(0, 0, 0, 0.15);
        }

        .btn-primary:hover::before {
            opacity: 1;
        }

        .btn-primary:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: white;
            color: #475569;
            border: 2px solid #e5e7eb;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .btn-secondary:hover {
            background: #f8fafc;
            border-color: #cbd5e1;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 48px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 3px solid rgba(36, 182, 145, 0.1);
            border-top: 3px solid #24b691;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            animation: spin 0.8s cubic-bezier(0.4, 0, 0.2, 1) infinite;
            margin: 0 auto 24px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .loading p {
            color: #475569;
            font-size: 15px;
            font-weight: 500;
        }

        .error-message {
            background: linear-gradient(135deg, #fef2f2 0%, #fee2e2 100%);
            border: 1px solid #fca5a5;
            color: #991b1b;
            padding: 16px 20px;
            border-radius: 12px;
            margin: 20px 0;
            display: none;
            font-size: 14px;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.1);
        }

        .error-message.active {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 20 20' fill='none'%3E%3Cpath d='M5 7.5L10 12.5L15 7.5' stroke='%2324b691' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 20px;
            padding-right: 40px;
            appearance: none;
        }

        input[type="date"]::-webkit-calendar-picker-indicator {
            filter: hue-rotate(180deg) brightness(0.8);
            cursor: pointer;
        }

        @media (max-width: 768px) {
            body {
                padding: 0;
            }

            .container {
                border-radius: 0;
                min-height: 100vh;
            }

            .header {
                padding: 32px 24px;
            }

            .header h1 {
                font-size: 26px;
            }

            .header p {
                font-size: 15px;
            }

            .form-container {
                padding: 32px 24px;
            }

            .section-title {
                font-size: 20px;
            }

            .btn-container {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }

            .scale-group {
                gap: 8px;
            }

            .scale-option {
                min-width: 50px;
                padding: 10px 8px;
            }

            .radio-option {
                padding: 10px 14px;
                font-size: 14px;
            }

            /* Ajustes adicionales para m√≥viles */
            label {
                font-size: 13px;
            }

            input[type="text"],
            input[type="email"],
            input[type="tel"],
            input[type="date"],
            input[type="number"],
            select,
            textarea {
                font-size: 16px;
                /* Evita zoom autom√°tico en iOS */
                padding: 12px 14px;
            }

            .form-section {
                margin-bottom: 28px;
                padding-bottom: 28px;
            }

            .form-group {
                margin-bottom: 20px;
            }

            .radio-group {
                gap: 12px;
            }

            .loading {
                padding: 32px 20px;
            }

            .spinner {
                width: 48px;
                height: 48px;
            }
        }

        /* Ajustes para pantallas muy peque√±as */
        @media (max-width: 480px) {
            .header h1 {
                font-size: 22px;
                line-height: 1.3;
            }

            .header p {
                font-size: 14px;
            }

            .form-container {
                padding: 24px 20px;
            }

            .section-title {
                font-size: 18px;
                margin-bottom: 20px;
            }

            .scale-group {
                gap: 6px;
                justify-content: space-around;
            }

            .scale-option {
                min-width: 42px;
                padding: 8px 6px;
            }

            .scale-option label {
                font-size: 11px;
            }

            .btn {
                padding: 14px 24px;
                font-size: 15px;
            }

            .success-modal-content {
                padding: 28px 20px;
                width: 90%;
            }

            .success-icon {
                width: 60px;
                height: 60px;
            }

            .success-icon svg {
                width: 30px;
                height: 30px;
            }

            .success-modal h3 {
                font-size: 20px;
                margin-bottom: 10px;
            }

            .success-modal p {
                font-size: 14px;
                margin-bottom: 24px;
            }

            .success-modal-btn {
                padding: 12px 32px;
                font-size: 15px;
            }
        }

        /* Mejoras para landscape en m√≥viles */
        @media (max-width: 768px) and (orientation: landscape) {
            .header {
                padding: 24px 20px;
            }

            .header h1 {
                font-size: 24px;
            }

            .success-modal-content {
                max-height: 90vh;
                overflow-y: auto;
            }
        }

        /* Evitar zoom en inputs en iOS */
        @supports (-webkit-touch-callout: none) {

            input[type="text"],
            input[type="email"],
            input[type="tel"],
            input[type="date"],
            input[type="number"],
            select,
            textarea {
                font-size: 16px;
            }
        }

        /* Animaciones de entrada */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .container {
            animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Estilos para placeholders */
        ::placeholder {
            color: #94a3b8;
            opacity: 1;
        }

        :-ms-input-placeholder {
            color: #94a3b8;
        }

        ::-ms-input-placeholder {
            color: #94a3b8;
        }

        /* Mejoras en validaci√≥n visual */
        input[style*="border-color: rgb(46, 204, 113)"],
        input[style*="border-color:#2ecc71"] {
            border-color: #10b981 !important;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.03) 0%, rgba(5, 150, 105, 0.03) 100%);
        }

        input[style*="border-color: rgb(231, 76, 60)"],
        input[style*="border-color:#e74c3c"] {
            border-color: #ef4444 !important;
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.03) 0%, rgba(220, 38, 38, 0.03) 100%);
        }

        /* Scrollbar personalizado */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #24b691 0%, #159895 100%);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #1a5f7a 0%, #159895 100%);
        }

        /* Suavizado de fuentes */
        body {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }

        /* Efectos de enfoque mejorados en radio/checkbox */
        input[type="radio"]:focus-visible {
            outline: 2px solid #24b691;
            outline-offset: 2px;
        }

        /* Modal de √©xito */
        .success-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .success-modal.active {
            display: flex;
        }

        .success-modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow:
                0 20px 60px rgba(0, 0, 0, 0.3),
                0 0 0 1px rgba(255, 255, 255, 0.1);
            animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .success-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 24px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: scaleIn 0.5s cubic-bezier(0.4, 0, 0.2, 1) 0.2s backwards;
        }

        @keyframes scaleIn {
            from {
                transform: scale(0);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .success-icon svg {
            width: 40px;
            height: 40px;
            stroke: white;
            stroke-width: 3;
            stroke-linecap: round;
            stroke-linejoin: round;
            fill: none;
        }

        .checkmark {
            stroke-dasharray: 50;
            stroke-dashoffset: 50;
            animation: drawCheck 0.5s ease forwards 0.4s;
        }

        @keyframes drawCheck {
            to {
                stroke-dashoffset: 0;
            }
        }

        .success-modal h3 {
            font-size: 28px;
            font-weight: 700;
            color: #1a1a1a;
            margin-bottom: 12px;
            letter-spacing: -0.5px;
        }

        .success-modal p {
            font-size: 16px;
            color: #64748b;
            line-height: 1.6;
            margin-bottom: 32px;
        }

        .success-modal-btn {
            background: linear-gradient(135deg, #1a5f7a 0%, #159895 50%, #24b691 100%);
            color: white;
            border: none;
            padding: 14px 40px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: 'Inter', sans-serif;
            letter-spacing: -0.2px;
            box-shadow: 0 4px 12px rgba(36, 182, 145, 0.25);
        }

        .success-modal-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(36, 182, 145, 0.35);
        }

        .success-modal-btn:active {
            transform: translateY(0);
        }

        @media (max-width: 768px) {
            .success-modal-content {
                padding: 32px 24px;
                width: 85%;
            }

            .success-icon {
                width: 70px;
                height: 70px;
            }

            .success-icon svg {
                width: 35px;
                height: 35px;
            }

            .success-modal h3 {
                font-size: 24px;
            }

            .success-modal p {
                font-size: 15px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üìã Diagn√≥stico para Asesor√≠a de Pensiones IMSS</h1>
            <p>El diagn√≥stico permite identificar con claridad la situaci√≥n actual del cliente y las oportunidades que
                puede aprovechar. Con esta evaluaci√≥n precisa, definimos la mejor estrategia para aumentar su beneficio,
                evitar errores y asegurar un tr√°mite √°gil y exitoso.</p>
        </div>

        <div class="form-container">
            <div class="error-message" id="errorMessage"></div>

            <form id="diagnosticForm">
                <!-- Secci√≥n 1: Datos Personales -->
                <div class="form-section">
                    <h2 class="section-title">üë§ Datos Personales</h2>

                    <div class="form-group">
                        <label for="nombreCompleto">Nombre completo (tal como lo indica su acta de nacimiento) <span
                                class="required">*</span></label>
                        <input type="text" id="nombreCompleto" name="nombreCompleto" required>
                    </div>

                    <div class="form-group">
                        <label for="fechaNacimiento">Fecha de nacimiento <span class="required">*</span></label>
                        <input type="date" id="fechaNacimiento" name="fechaNacimiento" required>
                    </div>

                    <div class="form-group">
                        <label for="sexo">Sexo <span class="required">*</span></label>
                        <select id="sexo" name="sexo" required>
                            <option value="">Seleccione...</option>
                            <option value="Masculino">Masculino</option>
                            <option value="Femenino">Femenino</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="lugarNacimiento">Lugar de nacimiento <span class="required">*</span></label>
                        <input type="text" id="lugarNacimiento" name="lugarNacimiento" placeholder="Ciudad, Estado"
                            required>
                    </div>

                    <div class="form-group">
                        <label for="lugarResidencia">Lugar de residencia <span class="required">*</span></label>
                        <input type="text" id="lugarResidencia" name="lugarResidencia" placeholder="Ciudad, Estado"
                            required>
                    </div>

                    <div class="form-group">
                        <label for="estadoCivil">Estado Civil <span class="required">*</span></label>
                        <select id="estadoCivil" name="estadoCivil" required>
                            <option value="">Seleccione...</option>
                            <option value="Soltero/a">Soltero/a</option>
                            <option value="Casado/a">Casado/a</option>
                            <option value="Divorciado/a">Divorciado/a</option>
                            <option value="Viudo/a">Viudo/a</option>
                            <option value="Uni√≥n libre">Uni√≥n libre</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="celular">N√∫mero de celular <span class="required">*</span></label>
                        <input type="tel" id="celular" name="celular" placeholder="10 d√≠gitos" required>
                    </div>

                    <div class="form-group">
                        <label for="email">Correo electr√≥nico <span class="required">*</span></label>
                        <input type="email" id="email" name="email" required>
                    </div>

                    <div class="form-group">
                        <label for="curp">CURP <span class="required">*</span></label>
                        <input type="text" id="curp" name="curp" maxlength="18" placeholder="18 caracteres" required>
                    </div>

                    <div class="form-group">
                        <label for="rfc">RFC <span class="required">*</span></label>
                        <input type="text" id="rfc" name="rfc" maxlength="13" placeholder="13 caracteres" required>
                    </div>

                    <div class="form-group">
                        <label for="dependientes">Dependientes econ√≥micos (nombre, parentesco y edad)</label>
                        <textarea id="dependientes" name="dependientes"
                            placeholder="Ej: Juan P√©rez (Hijo, 15 a√±os), Mar√≠a P√©rez (Hija, 12 a√±os)"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="nss">N√∫mero de seguridad social <span class="required">*</span></label>
                        <input type="text" id="nss" name="nss" maxlength="11" placeholder="11 d√≠gitos" required>
                    </div>
                </div>

                <!-- Secci√≥n 2: Informaci√≥n Laboral -->
                <div class="form-section">
                    <h2 class="section-title">üíº Informaci√≥n Laboral</h2>

                    <div class="form-group">
                        <label for="ocupacion">Ocupaci√≥n <span class="required">*</span></label>
                        <input type="text" id="ocupacion" name="ocupacion" required>
                    </div>

                    <div class="form-group">
                        <label for="gastosFijos">Gastos fijos mensuales (un aproximado) <span
                                class="required">*</span></label>
                        <input type="number" id="gastosFijos" name="gastosFijos" placeholder="$" required>
                    </div>

                    <div class="form-group">
                        <label for="fechaPrimeraCotizacion">Fecha de primera cotizaci√≥n <span
                                class="required">*</span></label>
                        <input type="date" id="fechaPrimeraCotizacion" name="fechaPrimeraCotizacion" required>
                    </div>

                    <div class="form-group">
                        <label for="fechaUltimaCotizacion">Fecha de √∫ltima cotizaci√≥n o est√° vigente <span
                                class="required">*</span></label>
                        <input type="text" id="fechaUltimaCotizacion" name="fechaUltimaCotizacion"
                            placeholder="Fecha o 'Vigente'" required>
                    </div>

                    <div class="form-group">
                        <label for="institucionCotizacion">Ante qu√© instituci√≥n est√° cotizando <span
                                class="required">*</span></label>
                        <select id="institucionCotizacion" name="institucionCotizacion" required>
                            <option value="">Seleccione...</option>
                            <option value="IMSS">IMSS</option>
                            <option value="ISSSTE">ISSSTE</option>
                            <option value="Otro">Otro</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="semanasCotizadas">Semanas cotizadas / A√±os de servicio <span
                                class="required">*</span></label>
                        <input type="text" id="semanasCotizadas" name="semanasCotizadas"
                            placeholder="Ej: 1250 semanas o 24 a√±os" required>
                    </div>

                    <div class="form-group">
                        <label for="ultimoSalario">√öltimo salario cotizado <span class="required">*</span></label>
                        <input type="number" id="ultimoSalario" name="ultimoSalario" placeholder="$" required>
                    </div>
                </div>

                <!-- Secci√≥n 3: Informaci√≥n INFONAVIT y Prestaciones -->
                <div class="form-section">
                    <h2 class="section-title">üè† INFONAVIT y Prestaciones</h2>

                    <div class="form-group">
                        <label for="creditoInfonavit">Cuenta con cr√©dito vigente de INFONAVIT/FOVISSSTE <span
                                class="required">*</span></label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="creditoSi" name="creditoInfonavit" value="S√≠" required>
                                <label for="creditoSi">S√≠</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="creditoNo" name="creditoInfonavit" value="No">
                                <label for="creditoNo">No</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="ayudaDesempleo">¬øHa solicitado la ayuda por desempleo, cu√°ntas veces y cu√°nto le han
                            dado en total?</label>
                        <textarea id="ayudaDesempleo" name="ayudaDesempleo"
                            placeholder="Ej: S√≠, 2 veces. Total recibido: $15,000"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="semanasDescontadas">¬øCu√°ntas semanas le descontaron por la o las ayuda de
                            desempleo?</label>
                        <input type="number" id="semanasDescontadas" name="semanasDescontadas"
                            placeholder="N√∫mero de semanas">
                    </div>

                    <div class="form-group">
                        <label for="variosNSS">¬øSabe si tiene varios NSS o periodos faltantes en su historial?</label>
                        <textarea id="variosNSS" name="variosNSS"
                            placeholder="Describa la situaci√≥n si aplica"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="simulacionLaboral">¬øHa tenido simulaci√≥n laboral en alg√∫n momento?</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="simulacionSi" name="simulacionLaboral" value="S√≠">
                                <label for="simulacionSi">S√≠</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="simulacionNo" name="simulacionLaboral" value="No">
                                <label for="simulacionNo">No</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="simulacionNoSe" name="simulacionLaboral" value="No s√©">
                                <label for="simulacionNoSe">No s√©</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="pensionPrevia">¬øTiene alguna pensi√≥n previa y de qu√© tipo?</label>
                        <textarea id="pensionPrevia" name="pensionPrevia"
                            placeholder="Tipo de pensi√≥n y detalles"></textarea>
                    </div>
                </div>

                <!-- Secci√≥n 4: AFORE y Planeaci√≥n -->
                <div class="form-section">
                    <h2 class="section-title">üí∞ AFORE y Planeaci√≥n de Retiro</h2>

                    <div class="form-group">
                        <label for="afore">AFORE en la que est√° registrado <span class="required">*</span></label>
                        <input type="text" id="afore" name="afore" placeholder="Nombre de la AFORE" required>
                    </div>

                    <div class="form-group">
                        <label for="edadPension">¬øA qu√© edad te gustar√≠a pensionarte? <span
                                class="required">*</span></label>
                        <input type="number" id="edadPension" name="edadPension" min="60" max="70" required>
                    </div>

                    <div class="form-group">
                        <label for="pensionIdeal">Pensi√≥n ideal estimada que te gustar√≠a alcanzar <span
                                class="required">*</span></label>
                        <input type="number" id="pensionIdeal" name="pensionIdeal" placeholder="$ mensual" required>
                    </div>

                    <div class="form-group">
                        <label for="visionM40">¬øC√≥mo ves la M40: gasto, inversi√≥n o negocio? <span
                                class="required">*</span></label>
                        <select id="visionM40" name="visionM40" required>
                            <option value="">Seleccione...</option>
                            <option value="Gasto">Gasto</option>
                            <option value="Inversi√≥n">Inversi√≥n</option>
                            <option value="Negocio">Negocio</option>
                            <option value="No estoy seguro">No estoy seguro</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="posibilidadPagoM40">¬øTienes posibilidades de pagar mensualidades en M40 y
                            cu√°nto?</label>
                        <input type="number" id="posibilidadPagoM40" name="posibilidadPagoM40"
                            placeholder="$ mensual disponible">
                    </div>

                    <div class="form-group">
                        <label for="financiamiento">¬øTe gustar√≠a ver opciones de financiamiento? Si s√≠, ¬øCu√°nto capital
                            tienes disponible para no pedir tanto pr√©stamo?</label>
                        <textarea id="financiamiento" name="financiamiento"
                            placeholder="Ejemplo: S√≠ me interesa. Tengo $50,000 disponibles"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="pensionMinima">Si no pudieras incrementar tu pensi√≥n, ¬øCon cu√°nto crees que podr√≠as
                            vivir?</label>
                        <input type="number" id="pensionMinima" name="pensionMinima" placeholder="$ mensual m√≠nimo">
                    </div>
                </div>

                <!-- Secci√≥n 5: Salud y Bienestar -->
                <div class="form-section">
                    <h2 class="section-title">üè• Salud y Bienestar</h2>

                    <div class="form-group">
                        <label>En una escala del 1 al 10, ¬øC√≥mo te sientes de salud? <span
                                class="required">*</span></label>
                        <div class="scale-group">
                            <div class="scale-option">
                                <input type="radio" id="salud1" name="escalaSalud" value="1" required>
                                <label for="salud1">1</label>
                            </div>
                            <div class="scale-option">
                                <input type="radio" id="salud2" name="escalaSalud" value="2">
                                <label for="salud2">2</label>
                            </div>
                            <div class="scale-option">
                                <input type="radio" id="salud3" name="escalaSalud" value="3">
                                <label for="salud3">3</label>
                            </div>
                            <div class="scale-option">
                                <input type="radio" id="salud4" name="escalaSalud" value="4">
                                <label for="salud4">4</label>
                            </div>
                            <div class="scale-option">
                                <input type="radio" id="salud5" name="escalaSalud" value="5">
                                <label for="salud5">5</label>
                            </div>
                            <div class="scale-option">
                                <input type="radio" id="salud6" name="escalaSalud" value="6">
                                <label for="salud6">6</label>
                            </div>
                            <div class="scale-option">
                                <input type="radio" id="salud7" name="escalaSalud" value="7">
                                <label for="salud7">7</label>
                            </div>
                            <div class="scale-option">
                                <input type="radio" id="salud8" name="escalaSalud" value="8">
                                <label for="salud8">8</label>
                            </div>
                            <div class="scale-option">
                                <input type="radio" id="salud9" name="escalaSalud" value="9">
                                <label for="salud9">9</label>
                            </div>
                            <div class="scale-option">
                                <input type="radio" id="salud10" name="escalaSalud" value="10">
                                <label for="salud10">10</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="padecimientos">¬øTienes alg√∫n padecimiento f√≠sico o emocional que debamos considerar
                            para tu planeaci√≥n?</label>
                        <textarea id="padecimientos" name="padecimientos"
                            placeholder="Describa cualquier condici√≥n relevante"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="retiroDigno">¬øUn retiro digno te dar√≠a estabilidad emocional y tranquilidad?</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="retiroSi" name="retiroDigno" value="Definitivamente s√≠">
                                <label for="retiroSi">Definitivamente s√≠</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="retiroProbablemente" name="retiroDigno" value="Probablemente">
                                <label for="retiroProbablemente">Probablemente</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="retiroNoSe" name="retiroDigno" value="No estoy seguro">
                                <label for="retiroNoSe">No estoy seguro</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="optimismo">¬øQu√© tan optimista te sientes para iniciar hoy tu proyecto de
                            retiro?</label>
                        <select id="optimismo" name="optimismo">
                            <option value="">Seleccione...</option>
                            <option value="Muy optimista">Muy optimista</option>
                            <option value="Optimista">Optimista</option>
                            <option value="Neutral">Neutral</option>
                            <option value="Algo pesimista">Algo pesimista</option>
                            <option value="Muy pesimista">Muy pesimista</option>
                        </select>
                    </div>
                </div>

                <!-- Secci√≥n 6: Documentaci√≥n -->
                <div class="form-section">
                    <h2 class="section-title">üìÑ Documentaci√≥n</h2>

                    <div class="form-group">
                        <label for="erroresDocumentos">Tiene conocimiento de alg√∫n error en los siguientes documentos:
                            Acta de nacimiento, INE, CURP, homonimia o alg√∫n error en el IMSS</label>
                        <textarea id="erroresDocumentos" name="erroresDocumentos"
                            placeholder="Describa cualquier error o inconsistencia conocida"></textarea>
                    </div>
                </div>

                <div class="btn-container">
                    <button type="button" class="btn btn-secondary"
                        onclick="document.getElementById('diagnosticForm').reset()">
                        üîÑ Limpiar Formulario
                    </button>
                    <button type="submit" class="btn btn-primary" id="submitBtn">
                        üöÄ Generar Informe PDF
                    </button>
                </div>
            </form>

            <div class="loading" id="loadingContainer">
                <div class="spinner"></div>
                <p style="color: #667eea; font-weight: 600;">Generando su informe profesional...</p>
                <p style="color: #666; margin-top: 10px;">Esto puede tomar entre 30-60 segundos</p>
            </div>
        </div>
    </div>

    <!-- Modal de √©xito -->
    <div class="success-modal" id="successModal">
        <div class="success-modal-content">
            <div class="success-icon">
                <svg viewBox="0 0 50 50">
                    <path class="checkmark" d="M14 27 L22 35 L38 16" />
                </svg>
            </div>
            <h3>¬°Informe Generado!</h3>
            <p>Su informe PDF ha sido generado exitosamente y se ha descargado autom√°ticamente.</p>
            <button class="success-modal-btn" onclick="cerrarModalExito()">Entendido</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        console.log('üöÄ Iniciando carga del script...');
        // ============================================================================
        // CONFIGURACI√ìN DE API - COLOCA TU API KEY DE OPENAI AQU√ç
        // ============================================================================
        const OPENAI_API_KEY = 'YOUR_API_KEY_HERE'; // Cambia esto por tu API Key real
        // ============================================================================
        console.log('üìù API Key configurada');

        // Prompt del consultor experto
        const CONSULTOR_PROMPT = `IMPORTANTE: Genera el informe SIN usar markdown (**negrita**, *cursiva*, etc.).
Usa TEXTO PLANO con estructura clara mediante:
- L√≠neas que empiecen con "A)", "B)", "C)" para secciones principales
- Para listas usa gui√≥n simple "- " al inicio
- Para vi√±etas con etiqueta usa formato "Etiqueta: descripci√≥n"
- NO uses asteriscos, corchetes ni s√≠mbolos especiales

Act√∫a como un CONSULTOR EXPERTO EN PENSIONES IMSS DE ALTO NIVEL,
especializado en el r√©gimen de la Ley del Seguro Social 1973,
Modalidad 40 (Continuaci√≥n Voluntaria en el R√©gimen Obligatorio),
auditor√≠a documental institucional y planeaci√≥n financiera para el retiro.
Tu nivel es equivalente a:
- Consultor certificado bajo el EC0485
- Especialista t√©cnico IMSS
- Analista financiero previsional
- Auditor documental (RENAPO, Registro Civil, INE, AFORE, IMSS)
- Consultor humano (salud f√≠sica, emocional y toma de decisiones)

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üéØ OBJETIVO PRINCIPAL
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Recibir√°s la informaci√≥n de un DIAGN√ìSTICO INTEGRAL dividido en 4 m√≥dulos:
1) Informaci√≥n legal y laboral
2) An√°lisis financiero
3) Auditor√≠a documental
4) Salud f√≠sica y psicol√≥gica

Con base en esta informaci√≥n, debes elaborar un
**REPORTE DE PREEVALUACI√ìN PENSIONAL PROFESIONAL**,
similar a un dictamen t√©cnico-consultivo,
listo para entregarse en formato PDF al cliente.

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üìå PRINCIPIOS OBLIGATORIOS
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
1. NO garantices pensiones ni montos finales.
2. NO sustituyas a la autoridad (IMSS, AFORE, Registro Civil).
3. NO realices c√°lculos oficiales finales.
4. S√ç analiza viabilidad, riesgos y escenarios preliminares.
5. S√â t√©cnico, √©tico, claro y profesional.
6. Usa lenguaje comprensible para el cliente, pero con fondo experto.
7. Todo debe ser PRELIMINAR y CONDICIONADO a validaciones posteriores.

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚öñÔ∏è BASE LEGAL Y T√âCNICA QUE DEBES CONOCER Y APLICAR
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
- Ley del Seguro Social 1973
- Art√≠culos 154 a 170 (vejez y cesant√≠a)
- Art√≠culos 194 a 196 (Continuaci√≥n Voluntaria ‚Äì Modalidad 40)
- Regla operativa: m√≠nimo 52 semanas en los √∫ltimos 5 a√±os para CVRO
- Plazo legal: 12 meses desde la baja para solicitar CVRO
- Topes salariales, UMA, semanas v√°lidas
- Riesgos de NSS m√∫ltiple, homonimia, simulaci√≥n laboral
- Importancia de CURP certificada, actas correctas y AFORE con homoclave

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üìä METODOLOG√çA DE AN√ÅLISIS (OBLIGATORIA)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

### PASO 1 ‚Äì RESUMEN GENERAL DEL CASO
Redacta un resumen ejecutivo que incluya:
- Edad, r√©gimen y semanas cotizadas
- Estado general de viabilidad del caso
- Objetivo del cliente (pensi√≥n deseada)
- Nivel de disposici√≥n financiera
- Estado general de salud y motivaci√≥n

### PASO 2 ‚Äì MATRIZ DE VIABILIDAD (SCORING)
Eval√∫a y clasifica el caso en:
- Legal / R√©gimen IMSS
- Financiero
- Documental
- Salud y emocional

Clasifica cada uno como:
üü¢ Favorable
üü° Condicionado
üî¥ Riesgo

Y emite un dictamen general:
- APTO
- APTO CONDICIONADO
- NO APTO POR EL MOMENTO

### PASO 3 ‚Äì AN√ÅLISIS T√âCNICO IMSS (SIN F√ìRMULAS)
Analiza:
- Semanas cotizadas y descontadas
- Vigencia de derechos
- √öltima cotizaci√≥n
- Elegibilidad preliminar para Modalidad 40
- Riesgos t√©cnicos detectados

NO muestres f√≥rmulas ni c√°lculos oficiales.

### PASO 4 ‚Äì AN√ÅLISIS DOCUMENTAL E INSTITUCIONAL
Identifica errores o riesgos en:
- Acta de nacimiento
- CURP
- INE
- AFORE
- IMSS (NSS, patrones, homonimia)

Explica c√≥mo estos errores pueden afectar un tr√°mite futuro
y la importancia de corregirlos antes de pensionarse.

### PASO 5 ‚Äì AN√ÅLISIS FINANCIERO PRELIMINAR
Analiza:
- Capacidad mensual real
- Capital disponible
- Necesidad o no de financiamiento
- Percepci√≥n del cliente sobre Modalidad 40

Plantea ESCENARIOS CONCEPTUALES:
- Sin estrategia
- Estrategia parcial
- Estrategia optimizada

SIN mencionar montos exactos finales garantizados.

### PASO 6 ‚Äì AN√ÅLISIS DE SALUD Y FACTOR HUMANO
Eval√∫a:
- Salud autopercibida
- Padecimientos relevantes
- Estr√©s financiero o emocional
- Optimismo y disposici√≥n a iniciar

Determina si el cliente puede sostener un proyecto de pensi√≥n
o si requiere un enfoque gradual y acompa√±ado.

### PASO 7 ‚Äì ESTRATEGIA PRELIMINAR RECOMENDADA
Enumera acciones sugeridas:
- Correcciones documentales prioritarias
- Definici√≥n de estrategia financiera
- Evaluaci√≥n de Modalidad 40
- Orden de ejecuci√≥n recomendado

### PASO 8 ‚Äì CONCLUSI√ìN PROFESIONAL Y SIGUIENTE PASO
Cierra el reporte indicando que:
- Este an√°lisis es PRELIMINAR
- No determina pensi√≥n final
- Para obtener cifras exactas y estrategia completa,
se requiere el **ESTUDIO DE PENSI√ìN PROFESIONAL**

Presenta el Estudio como:
- Paso l√≥gico
- Inversi√≥n informada
- Decisi√≥n consciente y sin presi√≥n

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üìÑ FORMATO DE SALIDA
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Entrega el resultado en texto estructurado listo para PDF, con secciones:

A) RESUMEN GENERAL DEL CASO
B) MATRIZ DE VIABILIDAD
C) RIESGOS T√âCNICOS IMSS
D) RIESGOS DOCUMENTALES
E) AN√ÅLISIS FINANCIERO PRELIMINAR
F) SALUD Y FACTOR HUMANO
G) ESTRATEGIA PRELIMINAR RECOMENDADA
H) ACLARACI√ìN PROFESIONAL Y SIGUIENTE PASO

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üîí AVISO FINAL OBLIGATORIO
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
Incluye siempre una aclaraci√≥n profesional indicando que:
- El presente an√°lisis es preliminar
- No sustituye resoluciones de autoridad
- Est√° sujeto a validaci√≥n documental y t√©cnica

IMPORTANTE: Responde √öNICAMENTE con el contenido del informe, estructurado y profesional, sin mencionar que eres un asistente de IA. Act√∫a como el consultor experto descrito.`;

        // Funci√≥n para calcular edad
        function calcularEdad(fechaNacimiento) {
            const hoy = new Date();
            const nacimiento = new Date(fechaNacimiento);
            let edad = hoy.getFullYear() - nacimiento.getFullYear();
            const mes = hoy.getMonth() - nacimiento.getMonth();

            if (mes < 0 || (mes === 0 && hoy.getDate() < nacimiento.getDate())) {
                edad--;
            }

            return edad;
        }

        // Funci√≥n para formatear los datos del formulario
        function formatearDatosFormulario(formData) {
            const edad = calcularEdad(formData.get('fechaNacimiento'));

            return `
DIAGN√ìSTICO INTEGRAL PARA ASESOR√çA DE PENSIONES IMSS

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
M√ìDULO 1: INFORMACI√ìN PERSONAL Y LEGAL
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

Nombre Completo: ${formData.get('nombreCompleto')}
Fecha de Nacimiento: ${formData.get('fechaNacimiento')} (${edad} a√±os)
Sexo: ${formData.get('sexo')}
Lugar de Nacimiento: ${formData.get('lugarNacimiento')}
Lugar de Residencia: ${formData.get('lugarResidencia')}
Estado Civil: ${formData.get('estadoCivil')}
Celular: ${formData.get('celular')}
Correo Electr√≥nico: ${formData.get('email')}
CURP: ${formData.get('curp')}
RFC: ${formData.get('rfc')}
Dependientes Econ√≥micos: ${formData.get('dependientes') || 'No especificado'}
N√∫mero de Seguridad Social: ${formData.get('nss')}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
M√ìDULO 2: INFORMACI√ìN LABORAL Y COTIZACI√ìN IMSS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

Ocupaci√≥n: ${formData.get('ocupacion')}
Gastos Fijos Mensuales: $${formData.get('gastosFijos')}
Fecha de Primera Cotizaci√≥n: ${formData.get('fechaPrimeraCotizacion')}
Fecha de √öltima Cotizaci√≥n: ${formData.get('fechaUltimaCotizacion')}
Instituci√≥n de Cotizaci√≥n: ${formData.get('institucionCotizacion')}
Semanas Cotizadas / A√±os de Servicio: ${formData.get('semanasCotizadas')}
√öltimo Salario Cotizado: $${formData.get('ultimoSalario')}

Cr√©dito INFONAVIT/FOVISSSTE Vigente: ${formData.get('creditoInfonavit')}
Ayuda por Desempleo: ${formData.get('ayudaDesempleo') || 'No especificado'}
Semanas Descontadas por Ayuda: ${formData.get('semanasDescontadas') || 'No aplica'}
NSS M√∫ltiples o Periodos Faltantes: ${formData.get('variosNSS') || 'No especificado'}
Simulaci√≥n Laboral: ${formData.get('simulacionLaboral') || 'No especificado'}
Pensi√≥n Previa: ${formData.get('pensionPrevia') || 'Ninguna'}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
M√ìDULO 3: PLANEACI√ìN FINANCIERA Y AFORE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

AFORE: ${formData.get('afore')}
Edad Deseada para Pensionarse: ${formData.get('edadPension')} a√±os
Pensi√≥n Ideal Estimada: $${formData.get('pensionIdeal')} mensuales
Visi√≥n sobre Modalidad 40: ${formData.get('visionM40')}
Posibilidad de Pago M40 Mensual: $${formData.get('posibilidadPagoM40') || 'No especificado'}
Inter√©s en Financiamiento: ${formData.get('financiamiento') || 'No especificado'}
Pensi√≥n M√≠nima con la que Podr√≠a Vivir: $${formData.get('pensionMinima') || 'No especificado'}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
M√ìDULO 4: SALUD F√çSICA Y PSICOL√ìGICA
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

Escala de Salud (1-10): ${formData.get('escalaSalud')}/10
Padecimientos F√≠sicos o Emocionales: ${formData.get('padecimientos') || 'Ninguno reportado'}
Retiro Digno y Estabilidad Emocional: ${formData.get('retiroDigno') || 'No especificado'}
Nivel de Optimismo para Iniciar Proyecto: ${formData.get('optimismo') || 'No especificado'}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
M√ìDULO 5: AUDITOR√çA DOCUMENTAL
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

Errores Conocidos en Documentos: ${formData.get('erroresDocumentos') || 'Ninguno reportado'}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

Con base en esta informaci√≥n completa, genera el REPORTE DE PREEVALUACI√ìN PENSIONAL PROFESIONAL siguiendo la metodolog√≠a establecida.`;
        }

        // Funci√≥n para mostrar error
        function mostrarError(mensaje) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = mensaje;
            errorDiv.classList.add('active');

            setTimeout(() => {
                errorDiv.classList.remove('active');
            }, 5000);
        }

        // Funci√≥n para llamar a OpenAI API
        async function generarInformeConIA(datosFormateados) {
            const url = 'https://api.openai.com/v1/chat/completions';

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${OPENAI_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o',
                        messages: [
                            {
                                role: 'system',
                                content: CONSULTOR_PROMPT
                            },
                            {
                                role: 'user',
                                content: datosFormateados
                            }
                        ],
                        temperature: 0.7,
                        max_tokens: 6000
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error?.message || 'Error al comunicarse con OpenAI');
                }

                const data = await response.json();
                return data.choices[0].message.content;
            } catch (error) {
                console.error('Error en API de OpenAI:', error);
                throw error;
            }
        }

        // Funci√≥n para generar PDF - VERSI√ìN LIMPIA Y PROFESIONAL
        function generarPDF(contenidoInforme, nombreCliente) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            const margenIzq = 20;
            const anchoTexto = 170;
            let yPos = 20;
            const lineHeight = 7;
            const margenInferior = 265;

            // Funci√≥n para limpiar TODO el markdown y caracteres especiales
            function limpiarTextoFinal(texto) {
                if (!texto) return '';

                // Eliminar TODOS los asteriscos (simples y dobles)
                texto = texto.replace(/\*+/g, '');

                // Eliminar corchetes con contenido
                texto = texto.replace(/\[[^\]]*\]/g, '');

                // Eliminar caracteres especiales de markdown
                texto = texto.replace(/[#]{1,6}\s*/g, '');
                texto = texto.replace(/[-‚îÅ‚ïê]{3,}/g, '');

                // Limpiar emojis
                const emojis = ['üü¢', 'üü°', 'üî¥', '‚úÖ', '‚ö†Ô∏è', '‚ùå', '‚úì', 'üìã', 'üë§', 'üíº', 'üè†', 'üí∞', 'üè•', 'üìÑ', 'üöÄ', 'üîÑ', 'üéØ', 'üìå', '‚öñÔ∏è', 'üìä', 'üîí'];
                emojis.forEach(emoji => {
                    texto = texto.replace(new RegExp(emoji, 'g'), '');
                });

                return texto.trim();
            }

            // Funci√≥n para verificar salto de p√°gina
            function verificarSaltoPagina() {
                if (yPos > margenInferior) {
                    doc.addPage();
                    yPos = 20;
                }
            }

            // Funci√≥n para agregar texto con wrap autom√°tico
            function agregarTextoSimple(texto, bold = false, fontSize = 10, color = [0, 0, 0], indent = 0) {
                texto = limpiarTextoFinal(texto);
                if (!texto) return;

                doc.setFontSize(fontSize);
                doc.setTextColor(...color);
                doc.setFont(undefined, bold ? 'bold' : 'normal');

                const lineas = doc.splitTextToSize(texto, anchoTexto - indent);
                lineas.forEach(linea => {
                    verificarSaltoPagina();
                    doc.text(linea, margenIzq + indent, yPos);
                    yPos += lineHeight;
                });
            }

            // Funci√≥n completa de limpieza de texto
            function limpiarTextoCompleto(texto) {
                if (!texto) return '';

                // Limpiar emojis
                const emojiMap = {
                    'üü¢': '', 'üü°': '', 'üî¥': '', '‚úÖ': '', '‚ö†Ô∏è': '', '‚ùå': '', '‚úì': '',
                    'üìã': '', 'üë§': '', 'üíº': '', 'üè†': '', 'üí∞': '', 'üè•': '', 'üìÑ': '',
                    'üöÄ': '', 'üîÑ': '', 'üéØ': '', 'üìå': '', '‚öñÔ∏è': '', 'üìä': '', 'üîí': ''
                };

                let resultado = texto;
                for (const [emoji, reemplazo] of Object.entries(emojiMap)) {
                    resultado = resultado.replace(new RegExp(emoji, 'g'), reemplazo);
                }

                // Limpiar todos los corchetes con contenido extra√±o
                resultado = resultado.replace(/\[[^\]]*\]/g, '');

                // Limpiar asteriscos dobles sueltos y markdown mal formado
                resultado = resultado.replace(/\*\*\s*\]\]/g, '');
                resultado = resultado.replace(/\(\*\*\s*\]\]/g, '');
                resultado = resultado.replace(/\(\*\*\s*/g, '');
                resultado = resultado.replace(/\*\*\s*\)/g, '');
                resultado = resultado.replace(/\]\]\)/g, '');

                // NUEVAS REGLAS ESPEC√çFICAS para los caracteres raros detectados:
                // Limpiar ** despu√©s de dos puntos (ej: "Edad:**" -> "Edad:")
                resultado = resultado.replace(/:\*\*\s*/g, ': ');

                // Limpiar ** al final de par√©ntesis (ej: "(**)" -> "")
                resultado = resultado.replace(/\(\*\*\)/g, '');

                // Limpiar par√©ntesis con ** y espacio (ej: "(** " -> "")
                resultado = resultado.replace(/\(\*\*\s+/g, '');

                // Limpiar ** al final de l√≠nea
                resultado = resultado.replace(/\*\*$/g, '');

                // Limpiar un solo asterisco al inicio (ej: "*Salud" -> "Salud")
                resultado = resultado.replace(/^\*([^*])/g, '$1');

                return resultado.trim();
            }

            // Mantener compatibilidad con c√≥digo existente
            function limpiarEmojis(texto) {
                return limpiarTextoCompleto(texto);
            }

            // Funci√≥n para procesar una l√≠nea con markdown **texto**
            function procesarMarkdown(texto) {
                const partes = [];
                const regex = /\*\*(.+?)\*\*/g;
                let lastIndex = 0;
                let match;

                while ((match = regex.exec(texto)) !== null) {
                    if (match.index > lastIndex) {
                        partes.push({
                            texto: texto.substring(lastIndex, match.index),
                            bold: false
                        });
                    }
                    partes.push({
                        texto: match[1],
                        bold: true
                    });
                    lastIndex = match.index + match[0].length;
                }

                if (lastIndex < texto.length) {
                    partes.push({
                        texto: texto.substring(lastIndex),
                        bold: false
                    });
                }

                if (partes.length === 0) {
                    partes.push({ texto: texto, bold: false });
                }

                return partes;
            }

            // Funci√≥n para agregar l√≠nea de viabilidad con indicador de color
            function agregarLineaViabilidad(texto) {
                // Limpiar la l√≠nea de vi√±etas, emojis y caracteres extra√±os
                texto = limpiarEmojis(texto);
                texto = texto.replace(/^\s*[-‚Ä¢*]\s*/, ''); // Quitar vi√±etas
                texto = texto.replace(/\[[^\]]*\]/g, ''); // Quitar todos los corchetes con contenido
                texto = texto.trim();

                // Detectar el tipo de indicador
                let color;
                let indicadorTexto = '';

                if (texto.match(/favorable/i)) {
                    color = [46, 204, 113]; // Verde
                    indicadorTexto = 'FAVORABLE';
                } else if (texto.match(/condicionado/i)) {
                    color = [241, 196, 15]; // Amarillo
                    indicadorTexto = 'CONDICIONADO';
                } else if (texto.match(/riesgo/i)) {
                    color = [231, 76, 60]; // Rojo
                    indicadorTexto = 'RIESGO';
                } else {
                    // Sin indicador espec√≠fico
                    agregarTexto(texto, 10, false, [0, 0, 0]);
                    return;
                }

                // Verificar salto de p√°gina
                if (yPos > margenInferior) {
                    doc.addPage();
                    yPos = 20;
                }

                // Dibujar c√≠rculo de color
                doc.setFillColor(...color);
                doc.circle(margenIzq + 5, yPos - 2, 2, 'F');

                // Extraer categor√≠a y descripci√≥n
                const partes = texto.split(':');
                if (partes.length >= 2) {
                    const categoria = partes[0].trim();
                    const descripcion = partes.slice(1).join(':').trim();

                    // Categor√≠a en negrita
                    doc.setFont(undefined, 'bold');
                    doc.setFontSize(10);
                    doc.setTextColor(0, 0, 0);
                    doc.text(categoria + ':', margenIzq + 10, yPos);

                    // Descripci√≥n normal con indicador de color
                    doc.setFont(undefined, 'normal');
                    doc.setTextColor(...color);
                    const anchoCategoria = doc.getTextWidth(categoria + ': ');

                    const textoIndicador = ` ${indicadorTexto}`;
                    doc.text(textoIndicador, margenIzq + 10 + anchoCategoria, yPos);

                    // Si hay descripci√≥n adicional
                    if (descripcion && descripcion.toLowerCase() !== indicadorTexto.toLowerCase()) {
                        doc.setTextColor(100, 100, 100);
                        const anchoIndicador = doc.getTextWidth(textoIndicador);
                        const descripcionLimpia = descripcion.replace(new RegExp(indicadorTexto, 'i'), '').trim();

                        if (descripcionLimpia && descripcionLimpia !== '') {
                            const lineasDesc = doc.splitTextToSize(
                                ` (${descripcionLimpia})`,
                                anchoTexto - anchoCategoria - anchoIndicador - 10
                            );

                            lineasDesc.forEach((linea, i) => {
                                if (i === 0) {
                                    doc.text(linea, margenIzq + 10 + anchoCategoria + anchoIndicador, yPos);
                                } else {
                                    yPos += lineHeight;
                                    if (yPos > margenInferior) {
                                        doc.addPage();
                                        yPos = 20;
                                    }
                                    doc.text(linea, margenIzq + 10, yPos);
                                }
                            });
                        }
                    }
                } else {
                    // Sin formato especial
                    doc.setFont(undefined, 'normal');
                    doc.setFontSize(10);
                    doc.setTextColor(...color);
                    doc.text(` ${indicadorTexto}`, margenIzq + 10, yPos);
                }

                yPos += lineHeight;
            }

            // Funci√≥n para procesar markdown y agregar texto con formato
            function agregarTextoConMarkdown(texto, fontSize = 10, color = [0, 0, 0]) {
                // Limpiar completamente el texto
                texto = limpiarTextoCompleto(texto);

                // Si no tiene markdown despu√©s de limpiar, usar funci√≥n simple
                if (!texto.includes('**')) {
                    agregarTexto(texto, fontSize, false, color);
                    return;
                }

                doc.setFontSize(fontSize);
                doc.setTextColor(...color);

                const partes = procesarMarkdown(texto);
                let xPos = margenIzq;

                partes.forEach((parte) => {
                    if (!parte.texto || parte.texto.trim() === '') return;

                    doc.setFont(undefined, parte.bold ? 'bold' : 'normal');

                    const palabras = parte.texto.split(' ').filter(p => p.trim() !== '');
                    palabras.forEach((palabra, i) => {
                        if (i > 0) palabra = ' ' + palabra;

                        const anchoPalabra = doc.getTextWidth(palabra);

                        if (xPos + anchoPalabra > margenIzq + anchoTexto) {
                            yPos += lineHeight;
                            xPos = margenIzq;

                            if (yPos > margenInferior) {
                                doc.addPage();
                                yPos = 20;
                            }

                            palabra = palabra.trim();
                        }

                        doc.text(palabra, xPos, yPos);
                        xPos += anchoPalabra;
                    });
                });

                yPos += lineHeight;
            }

            function agregarTexto(texto, fontSize = 10, isBold = false, color = [0, 0, 0]) {
                // Limpiar completamente el texto primero
                texto = limpiarTextoCompleto(texto);

                // Si despu√©s de limpiar a√∫n tiene markdown, procesarlo
                if (texto.includes('**')) {
                    agregarTextoConMarkdown(texto, fontSize, color);
                    return;
                }

                if (!texto || texto.trim() === '') return;

                doc.setFontSize(fontSize);
                doc.setTextColor(...color);

                if (isBold) {
                    doc.setFont(undefined, 'bold');
                } else {
                    doc.setFont(undefined, 'normal');
                }

                const lineas = doc.splitTextToSize(texto, anchoTexto);

                lineas.forEach(linea => {
                    if (yPos > margenInferior) {
                        doc.addPage();
                        yPos = 20;
                    }

                    doc.text(linea, margenIzq, yPos);
                    yPos += lineHeight;
                });
            }

            // Encabezado con degradado simulado
            doc.setFillColor(102, 126, 234);
            doc.rect(0, 0, 210, 45, 'F');

            // Borde decorativo
            doc.setDrawColor(255, 255, 255);
            doc.setLineWidth(0.5);
            doc.line(15, 42, 195, 42);

            doc.setTextColor(255, 255, 255);
            doc.setFontSize(22);
            doc.setFont(undefined, 'bold');
            doc.text('REPORTE DE PREEVALUACI√ìN', 105, 18, { align: 'center' });
            doc.setFontSize(20);
            doc.text('PENSIONAL PROFESIONAL', 105, 30, { align: 'center' });

            doc.setFontSize(9);
            doc.setFont(undefined, 'normal');
            doc.text('Diagn√≥stico Integral IMSS', 105, 38, { align: 'center' });

            yPos = 58;

            // Informaci√≥n del cliente en recuadro
            doc.setFillColor(248, 249, 250);
            doc.roundedRect(margenIzq - 5, yPos - 5, anchoTexto + 10, 18, 2, 2, 'F');

            doc.setDrawColor(102, 126, 234);
            doc.setLineWidth(0.3);
            doc.roundedRect(margenIzq - 5, yPos - 5, anchoTexto + 10, 18, 2, 2, 'S');

            doc.setTextColor(0, 0, 0);
            doc.setFontSize(12);
            doc.setFont(undefined, 'bold');
            doc.text(`Cliente: ${nombreCliente}`, margenIzq, yPos + 3);

            doc.setFontSize(9);
            doc.setFont(undefined, 'normal');
            const fecha = new Date().toLocaleDateString('es-MX', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            doc.text(`Fecha de emisi√≥n: ${fecha}`, margenIzq, yPos + 10);

            yPos += 25;

            // PROCESAMIENTO PRINCIPAL - LIMPIO Y SIMPLE
            const lineas = contenidoInforme.split('\n');

            lineas.forEach(linea => {
                // LIMPIAR TODO EL MARKDOWN PRIMERO
                let lineaLimpia = limpiarTextoFinal(linea);

                // Omitir l√≠neas vac√≠as o decorativas
                if (!lineaLimpia || lineaLimpia.trim() === '' || lineaLimpia.match(/^[-‚îÅ‚ïê%]+$/)) {
                    if (lineaLimpia.trim() === '') yPos += 2;
                    return;
                }

                // 1. T√çTULOS DE SECCIONES (A), B), C), etc.)
                if (lineaLimpia.match(/^[A-H]\)\s+/)) {
                    yPos += 10;
                    verificarSaltoPagina();

                    // L√≠nea decorativa
                    doc.setDrawColor(102, 126, 234);
                    doc.setLineWidth(0.5);
                    doc.line(margenIzq, yPos - 5, margenIzq + anchoTexto, yPos - 5);

                    // T√≠tulo en azul y negrita
                    agregarTextoSimple(lineaLimpia, true, 13, [102, 126, 234]);
                    yPos += 3;
                    return;
                }

                // 2. MATRIZ DE VIABILIDAD (Legal, Financiero, Documental, Salud)
                if (lineaLimpia.match(/(Legal|Financiero|Documental|Salud)\s*(\/ |y)?\s*[^:]*:/i)) {
                    // Limpiar y preparar
                    let textoViabilidad = limpiarTextoFinal(lineaLimpia);

                    let color, indicador;
                    if (textoViabilidad.match(/favorable/i)) {
                        color = [46, 204, 113];
                        indicador = 'FAVORABLE';
                    } else if (textoViabilidad.match(/condicionado/i)) {
                        color = [241, 196, 15];
                        indicador = 'CONDICIONADO';
                    } else if (textoViabilidad.match(/riesgo/i)) {
                        color = [231, 76, 60];
                        indicador = 'RIESGO';
                    } else {
                        agregarTextoSimple(textoViabilidad, false);
                        return;
                    }

                    verificarSaltoPagina();

                    // Dibujar c√≠rculo
                    doc.setFillColor(...color);
                    doc.circle(margenIzq + 5, yPos - 2, 2, 'F');

                    // Extraer y mostrar
                    const partes = textoViabilidad.split(':');
                    if (partes.length >= 2) {
                        const categoria = partes[0].trim();
                        const descripcion = partes.slice(1).join(':').trim();

                        // Categor√≠a en negrita
                        doc.setFont(undefined, 'bold');
                        doc.setFontSize(10);
                        doc.setTextColor(0, 0, 0);
                        doc.text(categoria + ':', margenIzq + 10, yPos);

                        // Indicador en color
                        const anchoCategoria = doc.getTextWidth(categoria + ': ');
                        doc.setFont(undefined, 'normal');
                        doc.setTextColor(...color);
                        doc.text(indicador, margenIzq + 10 + anchoCategoria, yPos);

                        // Descripci√≥n adicional si existe
                        if (descripcion && !descripcion.toLowerCase().includes(indicador.toLowerCase())) {
                            doc.setTextColor(100, 100, 100);
                            const anchoIndicador = doc.getTextWidth(indicador + ' ');
                            const lineasDesc = doc.splitTextToSize(
                                `(${descripcion})`,
                                anchoTexto - anchoCategoria - anchoIndicador - 10
                            );

                            lineasDesc.forEach((l, i) => {
                                if (i === 0) {
                                    doc.text(l, margenIzq + 10 + anchoCategoria + anchoIndicador, yPos);
                                } else {
                                    yPos += lineHeight;
                                    verificarSaltoPagina();
                                    doc.text(l, margenIzq + 10, yPos);
                                }
                            });
                        }
                    }

                    yPos += lineHeight;
                    return;
                }

                // 3. VI√ëETAS - Detectar patr√≥n "Etiqueta: descripci√≥n"
                const matchVineta = lineaLimpia.match(/^([A-Z√Å√â√ç√ì√ö√ë][^:]{2,60}):\s*(.+)$/);
                if (matchVineta) {
                    verificarSaltoPagina();

                    // Bullet point
                    doc.setFontSize(10);
                    doc.setTextColor(0, 0, 0);
                    doc.text('‚Ä¢', margenIzq + 3, yPos);

                    // Etiqueta en negrita
                    doc.setFont(undefined, 'bold');
                    doc.text(matchVineta[1] + ':', margenIzq + 8, yPos);

                    // Descripci√≥n normal
                    const anchoEtiqueta = doc.getTextWidth(matchVineta[1] + ': ');
                    doc.setFont(undefined, 'normal');
                    const lineasDesc = doc.splitTextToSize(matchVineta[2], anchoTexto - 8 - anchoEtiqueta);

                    lineasDesc.forEach((l, i) => {
                        if (i === 0) {
                            doc.text(l, margenIzq + 8 + anchoEtiqueta, yPos);
                        } else {
                            yPos += lineHeight;
                            verificarSaltoPagina();
                            doc.text(l, margenIzq + 8, yPos);
                        }
                    });

                    yPos += lineHeight;
                    return;
                }

                // 4. SUBT√çTULOS (l√≠nea que termina en :)
                if (lineaLimpia.match(/^[A-Z√Å√â√ç√ì√ö√ë][^:]{3,50}:$/)) {
                    yPos += 2;
                    agregarTextoSimple(lineaLimpia, true);
                    return;
                }

                // 5. TEXTO NORMAL
                agregarTextoSimple(lineaLimpia, false);
            });

            // Pie de p√°gina profesional
            const totalPages = doc.internal.getNumberOfPages();

            for (let i = 1; i <= totalPages; i++) {
                doc.setPage(i);

                // L√≠nea decorativa superior
                doc.setDrawColor(200, 200, 200);
                doc.setLineWidth(0.3);
                doc.line(20, 280, 190, 280);

                // Texto del pie de p√°gina
                doc.setFontSize(8);
                doc.setTextColor(128, 128, 128);
                doc.setFont(undefined, 'normal');

                doc.text(
                    'Documento confidencial - Uso exclusivo del cliente',
                    105,
                    285,
                    { align: 'center' }
                );

                doc.setFont(undefined, 'bold');
                doc.setTextColor(102, 126, 234);
                doc.text(
                    `P√°gina ${i} de ${totalPages}`,
                    105,
                    290,
                    { align: 'center' }
                );
            }

            const nombreArchivo = `Informe_Pension_${nombreCliente.replace(/ /g, '_')}_${new Date().getTime()}.pdf`;
            doc.save(nombreArchivo);
        }

        // Funciones para el modal de √©xito
        function mostrarModalExito() {
            const modal = document.getElementById('successModal');
            modal.classList.add('active');
            document.body.style.overflow = 'hidden'; // Prevenir scroll del fondo
        }

        function cerrarModalExito() {
            const modal = document.getElementById('successModal');
            modal.classList.remove('active');
            document.body.style.overflow = ''; // Restaurar scroll
        }

        // Cerrar modal al hacer clic fuera del contenido
        document.addEventListener('click', function (e) {
            const modal = document.getElementById('successModal');
            if (e.target === modal) {
                cerrarModalExito();
            }
        });

        // Cerrar modal con tecla ESC
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape') {
                cerrarModalExito();
            }
        });

        // Manejador del formulario
        document.getElementById('diagnosticForm').addEventListener('submit', async function (e) {
            console.log('üî• Formulario enviado - preventDefault activado');
            e.preventDefault();

            // Validar que la API Key est√© configurada
            if (!OPENAI_API_KEY || OPENAI_API_KEY === 'TU_API_KEY_AQUI') {
                mostrarError('‚ö†Ô∏è Error de configuraci√≥n: La API Key de OpenAI no ha sido configurada. Por favor, edita el archivo HTML y agrega tu API Key en la l√≠nea 547.');
                return;
            }

            const formData = new FormData(this);
            const nombreCliente = formData.get('nombreCompleto');

            document.getElementById('loadingContainer').classList.add('active');
            document.getElementById('submitBtn').disabled = true;

            try {
                const datosFormateados = formatearDatosFormulario(formData);
                const informeGenerado = await generarInformeConIA(datosFormateados);
                generarPDF(informeGenerado, nombreCliente);

                // Mostrar modal de √©xito
                mostrarModalExito();

            } catch (error) {
                console.error('Error:', error);
                mostrarError('‚ùå Error al generar el informe: ' + error.message);
            } finally {
                document.getElementById('loadingContainer').classList.remove('active');
                document.getElementById('submitBtn').disabled = false;
            }
        });

        // Validaciones en tiempo real
        document.getElementById('curp').addEventListener('input', function (e) {
            this.value = this.value.toUpperCase();
            if (this.value.length === 18) {
                const curpRegex = /^[A-Z]{4}[0-9]{6}[HM][A-Z]{5}[0-9A-Z][0-9]$/;
                this.style.borderColor = curpRegex.test(this.value) ? '#2ecc71' : '#e74c3c';
            }
        });

        document.getElementById('rfc').addEventListener('input', function (e) {
            this.value = this.value.toUpperCase();
            if (this.value.length === 13) {
                const rfcRegex = /^[A-Z√ë&]{4}[0-9]{6}[A-Z0-9]{3}$/;
                this.style.borderColor = rfcRegex.test(this.value) ? '#2ecc71' : '#e74c3c';
            }
        });

        document.getElementById('nss').addEventListener('input', function (e) {
            this.value = this.value.replace(/\D/g, '');
            if (this.value.length === 11) {
                this.style.borderColor = '#2ecc71';
            }
        });

        document.getElementById('celular').addEventListener('input', function (e) {
            this.value = this.value.replace(/\D/g, '');
            if (this.value.length === 10) {
                this.style.borderColor = '#2ecc71';
            }
        });

        console.log('‚úÖ Sistema de Diagn√≥stico de Pensiones IMSS cargado correctamente');
    </script>
</body>

</html>